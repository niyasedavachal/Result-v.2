import{c as v,r as a,i,j as e,av as I,R as y,C as Z,aA as X,U as _,J as K,b as ee,g as te,G as se,q as ae,O as le,Z as re,d as L,Q as de,au as ne,e as ie}from"./index-CR8CapFt.js";import{P as oe}from"./plus-BN13murC.js";import{C as ce}from"./calendar-days-Div_RGjT.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=v("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=v("FileBarChart",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M12 18v-4",key:"q1q25u"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M16 18v-6",key:"15y0np"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=v("Radar",[["path",{d:"M19.07 4.93A10 10 0 0 0 6.99 3.34",key:"z3du51"}],["path",{d:"M4 6h.01",key:"oypzma"}],["path",{d:"M2.29 9.62A10 10 0 1 0 21.31 8.35",key:"qzzz0"}],["path",{d:"M16.24 7.76A6 6 0 1 0 8.23 16.67",key:"1yjesh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M17.99 11.66A6 6 0 0 1 15.77 16.67",key:"1u2y91"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"m13.41 10.59 5.66-5.66",key:"mhq4k0"}]]),je=({setActiveTab:c,classes:k,pendingAdmissions:p,onRefresh:x,setShowPublishModal:ue,setShowStudentEntryModal:B,featureCosts:h,setShowResultUpload:U})=>{const[r,z]=a.useState(null),[m,C]=a.useState(0),[u,T]=a.useState(0),[$,f]=a.useState(!1),[q,G]=a.useState(""),[H,o]=a.useState(!1),[Y,be]=a.useState("TERM"),[S,P]=a.useState(""),[j,R]=a.useState(""),[w,b]=a.useState(!1),[D,F]=a.useState([]),[W,A]=a.useState(!1);a.useEffect(()=>{M()},[]),a.useEffect(()=>{const t=k.reduce((s,l)=>s+(l.studentCount||0),0);T(t)},[k]);const M=async()=>{const[t,s]=await Promise.all([i.getHolidayRadar(),i.getSchoolConfig()]);z(t),s&&(G(s.id),C(s.walletBalance||0),f(!!s.scheduledPublishDate))},E=async(t,s)=>{if(s==="APPROVE"){const l=await i.verifyStudent(t,"Admin");l.success?x():alert(l.message)}else{if(!window.confirm("Reject this admission?"))return;(await i.rejectAdmission(t)).success&&x()}},V=async()=>{o(!0),A(!0);const s=(await i.getSchoolProgress()).map(n=>({className:n.name,total:n.totalStudents,graded:n.gradedCount,status:n.gradedCount>=n.totalStudents&&n.totalStudents>0?"READY":"PENDING"}));F(s),A(!1);const l=new Date;l.setMinutes(l.getMinutes()-l.getTimezoneOffset()),P(l.toISOString().slice(0,16));const d=new Date;d.setDate(d.getDate()+30),d.setMinutes(d.getMinutes()-d.getTimezoneOffset()),R(d.toISOString().slice(0,16))},J=async()=>{if(!confirm("Are you sure? Results will be hidden from public immediately."))return;b(!0);const t=await i.updateSchoolSettings({scheduledPublishDate:null});b(!1),t.success?(alert("Results Unpublished."),f(!1),o(!1),x()):alert("Failed to unpublish.")},Q=async()=>{const t=h.results||1,s=u*t;if(m<s){alert(`Insufficient Balance!

Required: ${s} CR
Available: ${m} CR

Please recharge to publish.`),c("billing");return}const l=D.filter(O=>O.graded<O.total).length;if(l>0&&!confirm(`âš ï¸ Warning: ${l} classes have incomplete marks.

Students without marks will see "Results Withheld".

Proceed anyway?`))return;b(!0);const d=S||new Date(Date.now()-6e4).toISOString(),n=j?new Date(j).toISOString():void 0;await i.updateSchoolSettings({resultExpiryDate:n});const g=await i.publishResultWithPayment(Y,d,t);b(!1),g.success?(o(!1),alert("ðŸš€ Results Published Successfully!"),x(),f(!0),g.newBalance!==void 0?C(g.newBalance):M()):alert("Publish Failed: "+g.message)},N=()=>`${window.location.origin}/#/result?schoolId=${q}`;return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"bg-slate-900 rounded-2xl p-4 text-white flex flex-col md:flex-row items-center justify-between gap-4 border border-slate-800 shadow-xl overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 pointer-events-none",children:e.jsx(I,{className:"w-24 h-24"})}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto relative z-10",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:e.jsx(y,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm",children:"Testing & Preview URL"}),e.jsx("p",{className:"text-[10px] text-slate-400 font-mono break-all",children:N()})]})]}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto relative z-10",children:[e.jsxs("button",{onClick:()=>window.open(N(),"_blank"),className:"flex-1 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-xs font-bold border border-white/10 flex items-center justify-center gap-2 transition-all",children:[e.jsx(I,{className:"w-3 h-3"})," Open Preview"]}),e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(N()),alert("Link Copied!")},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all shadow-lg shadow-blue-900/40",children:[e.jsx(Z,{className:"w-3 h-3"})," Copy URL"]})]})]}),r&&e.jsxs("div",{className:`p-4 rounded-xl border-l-4 shadow-lg flex items-center justify-between ${r.type==="HOLIDAY"?"bg-red-50 dark:bg-red-900/20 border-red-500":"bg-indigo-50 dark:bg-indigo-900/20 border-indigo-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center shrink-0 ${r.type==="HOLIDAY"?"bg-red-100 text-red-600":"bg-indigo-100 text-indigo-600"}`,children:r.type==="HOLIDAY"?e.jsx(xe,{className:"w-5 h-5 animate-bounce"}):e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-bold text-sm ${r.type==="HOLIDAY"?"text-red-800 dark:text-red-200":"text-indigo-800 dark:text-indigo-200"}`,children:r.message}),e.jsxs("p",{className:"text-[10px] opacity-70 flex items-center gap-1",children:[e.jsx(me,{className:"w-3 h-3"})," Radar Confidence: ",r.confidence,"% â€¢ Region: ",r.region]})]})]}),r.type==="HOLIDAY"&&e.jsx("button",{onClick:()=>c("calendar"),className:"text-xs bg-white dark:bg-slate-800 px-3 py-1.5 rounded-lg font-bold text-red-600 hover:bg-red-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Update Calendar"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("button",{onClick:()=>c("classes"),className:"bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-5 rounded-2xl shadow-lg shadow-blue-500/20 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-white/20 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(oe,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:"Add Class"}),e.jsx("p",{className:"text-blue-100 text-xs opacity-80",children:"Step 1: Create"})]}),e.jsxs("button",{onClick:()=>B(!0),className:"bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-orange-100 dark:bg-orange-900/30 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(_,{className:"w-6 h-6 text-orange-600 dark:text-orange-400"})}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-none mb-1",children:"Add Students"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"Step 2: Quick Entry"})]}),e.jsxs("button",{onClick:()=>U(!0),className:"bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 p-5 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-700 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-purple-100 dark:bg-purple-900/30 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(K,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-white leading-none mb-1",children:"Upload Result"}),e.jsx("p",{className:"text-slate-500 text-xs",children:"One-Click CSV"})]}),e.jsxs("button",{onClick:V,className:"bg-gradient-to-br from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white p-5 rounded-2xl shadow-lg shadow-green-500/20 text-left transition-transform hover:-translate-y-1",children:[e.jsx("div",{className:"bg-white/20 w-10 h-10 rounded-lg flex items-center justify-center mb-3",children:e.jsx(y,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"font-bold text-lg leading-none mb-1",children:"Publish Report"}),e.jsx("p",{className:"text-green-100 text-xs opacity-80",children:"Final Step: Go Live"})]})]}),p.length>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-xl p-4 animate-pulse",children:[e.jsxs("h4",{className:"font-bold text-orange-800 dark:text-orange-200 flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-5 h-5"})," Pending Admissions (",p.length,")"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-2 max-h-60 overflow-y-auto",children:p.map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg flex justify-between items-center shadow-sm border border-slate-100",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-sm",children:t.name}),e.jsx("span",{className:"text-[10px] bg-slate-100 px-1 rounded",children:t.className})]}),e.jsxs("span",{className:"text-xs text-slate-500",children:[t.gender,", ",te(t.dob)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>E(t.id,"APPROVE"),className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-bold hover:bg-green-200",children:"Approve"}),e.jsx("button",{onClick:()=>E(t.id,"REJECT"),className:"text-xs bg-red-100 text-red-700 px-2 py-1 rounded font-bold hover:bg-red-200",children:"Reject"})]})]},t.id))})]}),H&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(se,{className:"max-w-3xl w-full relative border-t-4 border-emerald-600 bg-white dark:bg-slate-900 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 pb-0 border-b border-slate-100 dark:border-slate-800 flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(y,{className:"w-6 h-6 text-emerald-600"})," Official Result Publisher"]}),e.jsx("p",{className:"text-slate-500 text-sm mt-1",children:"Publish Term Exams & Final Results."})]}),e.jsx("button",{onClick:()=>o(!1),className:"text-slate-400 hover:text-slate-600",children:e.jsx(ae,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"})," 1. Marks Entry Audit"]}),W?e.jsx("div",{className:"p-4 text-center text-slate-500 text-xs",children:"Scanning Classes..."}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:D.map((t,s)=>e.jsxs("div",{className:`p-3 rounded-lg border flex flex-col ${t.status==="READY"?"bg-green-50 dark:bg-green-900/10 border-green-200 dark:border-green-900":"bg-red-50 dark:bg-red-900/10 border-red-200 dark:border-red-900"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"font-bold text-sm text-slate-800 dark:text-white",children:t.className}),t.status==="PENDING"&&e.jsx(le,{className:"w-3 h-3 text-red-500"})]}),e.jsx("div",{className:"w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full mb-1",children:e.jsx("div",{className:`h-1.5 rounded-full ${t.status==="READY"?"bg-green-500":"bg-red-500"}`,style:{width:`${t.graded/t.total*100}%`}})}),e.jsxs("span",{className:"text-[10px] text-slate-500",children:[t.graded," / ",t.total," Graded"]})]},s))})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wider flex items-center gap-2 mb-3",children:[e.jsx(re,{className:"w-4 h-4"})," 2. Report Type"]}),e.jsxs("div",{className:"p-4 rounded-xl border-2 border-emerald-500 bg-emerald-50 dark:bg-emerald-900/10",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"font-bold text-emerald-700 dark:text-emerald-400 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"})," Official Term / Final Exam"]}),e.jsxs("span",{className:"bg-orange-100 text-orange-700 text-[10px] font-bold px-2 py-0.5 rounded",children:[h.results||1," Credit/Student"]})]}),e.jsxs("ul",{className:"text-[10px] text-slate-600 dark:text-slate-400 space-y-1 list-disc pl-4",children:[e.jsx("li",{className:"font-bold text-emerald-600",children:"Generates Official Report Card"}),e.jsx("li",{children:"Calculates Rank & Class Position"}),e.jsx("li",{children:"Stored in permanent academic record"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Publish Date"}),e.jsx(L,{type:"datetime-local",value:S,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Auto-Expiry"}),e.jsx(L,{type:"datetime-local",value:j,onChange:t=>R(t.target.value)})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg flex items-center justify-between border border-blue-100 dark:border-blue-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-blue-700 dark:text-blue-300",children:"Wallet Check"}),e.jsxs("p",{className:"text-[10px] text-blue-600 dark:text-blue-400",children:["Students: ",u," | Cost: ",u*(h.results||1)," CR | Bal: ",m," CR"]})]})]}),m<u*(h.results||1)&&e.jsx("button",{onClick:()=>{o(!1),c("billing")},className:"text-[10px] bg-blue-600 text-white px-2 py-1 rounded font-bold",children:"Recharge"})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-950 flex gap-3 justify-end",children:[$&&e.jsxs("button",{onClick:J,disabled:w,className:"px-4 py-3 bg-red-100 text-red-600 hover:bg-red-200 rounded-xl text-sm font-bold flex items-center justify-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"})," Unpublish"]}),e.jsx("button",{onClick:()=>o(!1),className:"px-6 py-3 text-slate-500 font-bold text-sm hover:text-slate-700",children:"Cancel"}),e.jsx(ie,{onClick:Q,disabled:w,className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-lg shadow-emerald-900/20 px-8 py-3",children:w?"Processing...":"Confirm & Publish"})]})]})})]})};export{je as default};
