import{c as P,r as t,j as e,G as y,U as ue,y as Ie,Z as q,ac as K,a4 as oe,i as u,N as X,a6 as Le,ad as ke,ae as as,e as U,k as ls,w as De,K as be,af as rs,ag as ns,Y as Pe,z as cs,ah as is,ai as os,aa as de,x as Q,A as ds,a as pe,ab as xs,aj as ye,q as xe,b as Se,ak as Fe,X as ge,M as Oe,d as B,n as ms,al as ee,a5 as hs,am as me,B as ve,F as us,p as bs,an as ps,ao as gs,ap as fs,L as Ue,aq as Ns,ar as js,C as Ee,as as vs,P as ws,V as ys,a7 as Te,W as Me,v as Ss,at as Ge,l as Be,u as Es,au as Ts}from"./index-DQrliTbI.js";import{T as he}from"./trash-2-Dg4GPURe.js";import{P as Cs}from"./palette-BlLdoFV6.js";import{S as fe}from"./save-Bhqy8dfW.js";import{A as Z}from"./activity-B62hn_c3.js";import{P as Ce}from"./plus-circle-DBfYKsZf.js";import{P as ie}from"./pen-square-D5zT7f_l.js";import{L as As}from"./layers-CIyj5lK5.js";import{H as _s}from"./history-NwoX3KGx.js";import{C as Rs}from"./calendar-clock-BNS3s7hC.js";import{L as Is}from"./layout-grid-hJVM94uc.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=P("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=P("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=P("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=P("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=P("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=P("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=P("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=P("Ghost",[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=P("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=P("LifeBuoy",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.93 4.93 4.24 4.24",key:"1ymg45"}],["path",{d:"m14.83 9.17 4.24-4.24",key:"1cb5xl"}],["path",{d:"m14.83 14.83 4.24 4.24",key:"q42g0n"}],["path",{d:"m9.17 14.83-4.24 4.24",key:"bqpfvv"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=P("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=P("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=P("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=P("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=P("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=P("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hs=P("Terminal",[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=P("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=P("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=P("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Ys=()=>{var m,d;const[s,n]=t.useState(null),[w,f]=t.useState(!0);if(t.useEffect(()=>{const N=async()=>{const h=await u.getAdvancedSystemStats();n(h),f(!1)};N();const r=setInterval(N,3e4);return()=>clearInterval(r)},[]),w)return e.jsx("div",{className:"text-center text-slate-500 py-20 font-mono",children:"INITIALIZING TELEMETRY..."});const a=((s==null?void 0:s.totalSchools)||0)>0;return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(y,{className:"bg-slate-900 border border-slate-800 relative overflow-hidden group hover:border-blue-500/50 transition-all",children:[e.jsx("div",{className:"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(ue,{className:"w-16 h-16 text-blue-500"})}),e.jsx("p",{className:"text-xs font-mono text-blue-400 mb-1",children:"TOTAL USERS"}),e.jsx("h2",{className:"text-3xl font-black text-white",children:(m=s==null?void 0:s.totalStudents)==null?void 0:m.toLocaleString()}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-green-400 mt-2",children:[e.jsx(Ls,{className:"w-3 h-3"})," +",s==null?void 0:s.dailyGrowthRate,"% Today"]})]}),e.jsxs(y,{className:"bg-slate-900 border border-slate-800 relative overflow-hidden group hover:border-green-500/50 transition-all",children:[e.jsx("div",{className:"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(we,{className:"w-16 h-16 text-green-500"})}),e.jsx("p",{className:"text-xs font-mono text-green-400 mb-1",children:"REVENUE (MRR)"}),e.jsxs("h2",{className:"text-3xl font-black text-white",children:["₹",(d=s==null?void 0:s.totalRevenue)==null?void 0:d.toLocaleString()]}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-400 mt-2",children:[s==null?void 0:s.proSchools," Active Subscriptions"]})]}),e.jsxs(y,{className:"bg-slate-900 border border-slate-800 relative overflow-hidden group hover:border-purple-500/50 transition-all",children:[e.jsx("div",{className:"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(Ie,{className:"w-16 h-16 text-purple-500"})}),e.jsx("p",{className:"text-xs font-mono text-purple-400 mb-1",children:"ACTIVE SCHOOLS"}),e.jsx("h2",{className:"text-3xl font-black text-white",children:s==null?void 0:s.totalSchools}),e.jsx("div",{className:"flex items-center gap-1 text-[10px] text-slate-400 mt-2",children:"Across 12 Districts"})]}),e.jsxs(y,{className:"bg-slate-900 border border-slate-800 relative overflow-hidden group hover:border-orange-500/50 transition-all",children:[e.jsx("div",{className:"absolute right-0 top-0 p-3 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(q,{className:"w-16 h-16 text-orange-500"})}),e.jsx("p",{className:"text-xs font-mono text-orange-400 mb-1",children:"LIVE TRAFFIC"}),e.jsx("h2",{className:"text-3xl font-black text-white",children:s==null?void 0:s.activeUsersNow}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-green-400 mt-2 animate-pulse",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"})," Online Now"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-slate-900 border border-slate-800 rounded-xl p-6 relative overflow-hidden",children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-400 mb-4 flex items-center gap-2",children:[e.jsx(qs,{className:"w-4 h-4"})," SYSTEM LATENCY"]}),e.jsx("div",{className:"flex items-end gap-1 h-32 w-full",children:[...Array(40)].map((N,r)=>{const h=Math.floor(Math.random()*80)+10;return e.jsx("div",{className:`flex-1 rounded-t-sm transition-all duration-500 ${h>70?"bg-red-500":h>40?"bg-blue-500":"bg-slate-700"}`,style:{height:`${h}%`}},r)})}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs font-mono text-slate-500",children:[e.jsx("span",{children:"-60s"}),e.jsxs("span",{className:"text-green-400",children:[s==null?void 0:s.serverLatency,"ms avg"]}),e.jsx("span",{children:"Now"})]})]}),e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-xl p-6 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-slate-400 mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"})," DATABASE LOAD"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-300 mb-1",children:[e.jsx("span",{children:"Storage Used"}),e.jsxs("span",{children:[s==null?void 0:s.dbSizeMB," MB"]})]}),e.jsx("div",{className:"w-full bg-slate-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-blue-500 h-full rounded-full",style:{width:a?"15%":"1%"}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-300 mb-1",children:[e.jsx("span",{children:"API Requests (1m)"}),e.jsx("span",{children:a?"1,204":"0"})]}),e.jsx("div",{className:"w-full bg-slate-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:"bg-green-500 h-full rounded-full",style:{width:a?"45%":"0%"}})})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-800 text-[10px] text-slate-500 flex justify-between",children:[e.jsx("span",{children:"Region: ap-south-1"}),e.jsx("span",{className:"text-green-500 font-bold",children:"HEALTHY"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-900/20 to-blue-900/20 border border-slate-800 rounded-xl p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-indigo-500/20 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-bold",children:"AI Growth Prediction"}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Based on current trajectory, we expect ",e.jsx("span",{className:"text-white font-bold",children:"+50 schools"})," next month."]})]})]}),e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:"text-[10px] uppercase text-slate-500 font-bold",children:"Projected Revenue"}),e.jsxs("p",{className:"text-xl font-mono text-green-400",children:["₹",((s==null?void 0:s.totalRevenue)||0)*1.2]})]})]}),!a&&e.jsx("div",{className:"text-center text-[10px] text-slate-600 uppercase tracking-widest mt-4",children:"System running in Fresh/Mock Mode. Connect to Supabase for live data."})]})},qs=({className:s})=>e.jsx("svg",{className:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M22 12h-4l-3 9L9 3l-3 9H2"})}),Ks=`
DO $$ 
BEGIN 
    -- STUDENTS TABLE FIXES
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='students' AND column_name='added_by') THEN
        ALTER TABLE students ADD COLUMN added_by TEXT;
    END IF;
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='students' AND column_name='verified_by') THEN
        ALTER TABLE students ADD COLUMN verified_by TEXT;
    END IF;
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='students' AND column_name='is_archived') THEN
        ALTER TABLE students ADD COLUMN is_archived BOOLEAN DEFAULT FALSE;
    END IF;
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='students' AND column_name='social_links') THEN
        ALTER TABLE students ADD COLUMN social_links JSONB DEFAULT '{}';
    END IF;

    -- SCHOOLS TABLE FIXES
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='schools' AND column_name='principal_email') THEN
        ALTER TABLE schools ADD COLUMN principal_email TEXT;
        ALTER TABLE schools ADD COLUMN principal_password TEXT;
        ALTER TABLE schools ADD COLUMN has_principal_login BOOLEAN DEFAULT FALSE;
        ALTER TABLE schools ADD COLUMN principal_invite_token TEXT;
        ALTER TABLE schools ADD COLUMN principal_invite_expires TIMESTAMP WITH TIME ZONE;
    END IF;

    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='campus_posts' AND column_name='likes') THEN
        ALTER TABLE campus_posts ADD COLUMN likes INTEGER DEFAULT 0;
        ALTER TABLE campus_posts ADD COLUMN scheduled_at TIMESTAMP WITH TIME ZONE;
    END IF;
    
    -- Wallet Balance Check
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='schools' AND column_name='wallet_balance') THEN
        ALTER TABLE schools ADD COLUMN wallet_balance INTEGER DEFAULT 0;
    END IF;

    -- Result Expiry Check
    IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='schools' AND column_name='result_expiry_date') THEN
        ALTER TABLE schools ADD COLUMN result_expiry_date TIMESTAMP WITH TIME ZONE;
    END IF;
    
    -- Transaction Table Check
    CREATE TABLE IF NOT EXISTS credit_transactions_v2 (
        id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
        school_id UUID REFERENCES schools(id) ON DELETE CASCADE,
        amount INTEGER NOT NULL,
        type TEXT NOT NULL, -- CREDIT / DEBIT
        description TEXT,
        category TEXT,
        user_role TEXT,
        user_id UUID,
        transaction_id TEXT,
        meta JSONB,
        created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
END $$;
`,zs=()=>{const[s,n]=t.useState([]),[w,f]=t.useState(!0),[a,m]=t.useState(null),[d,N]=t.useState(""),[r,h]=t.useState(!1),[l,p]=t.useState(""),[j,C]=t.useState(!1),[i,g]=t.useState(!1);t.useEffect(()=>{S()},[]);const S=async()=>{f(!0);const v=await u.getAllSupportTickets();n(v),f(!1)},_=v=>{m(v),N(v.aiSuggestedReply||""),v.category==="BUG"&&v.userEmail&&p(v.userEmail)},b=async()=>{!a||!d||(h(!0),await u.resolveTicket(a.id,d),h(!1),m(null),S(),alert("Ticket Resolved & User Notified"))},E=async()=>{if(!l)return alert("Enter email address");if(!confirm(`Force delete account for ${l}? This allows them to sign up again.`))return;C(!0);const v=await u.forceDeleteUser(l);C(!1),v.success?(alert(v.message),p("")):alert("Failed: "+v.message)},L=async()=>{if(!confirm("This will attempt to create missing columns/tables. Continue?"))return;g(!0);const v=await u.runDatabaseMigration(Ks);g(!1),alert(v.success?"Schema Fix Executed. Ask user to try again.":"Failed: "+v.message)},I=async()=>{confirm("This will purge server cache. Continue?")&&(g(!0),await u.triggerAutoHeal("CACHE"),g(!1),alert("System Cache Purged."))};return e.jsxs("div",{className:"h-[calc(100vh-140px)] flex gap-6 animate-fade-in-up",children:[e.jsxs("div",{className:"w-1/3 bg-slate-900 border border-slate-800 rounded-xl overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-blue-500"})," Inbox (",s.filter(v=>v.status==="OPEN").length,")"]}),e.jsx("button",{onClick:S,className:"text-slate-500 hover:text-white",children:e.jsx(X,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[s.length===0&&e.jsx("div",{className:"p-8 text-center text-slate-500 text-sm",children:"No tickets found."}),s.map(v=>e.jsxs("div",{onClick:()=>_(v),className:`p-4 border-b border-slate-800 cursor-pointer hover:bg-slate-800/50 transition-colors ${(a==null?void 0:a.id)===v.id?"bg-slate-800 border-l-4 border-l-blue-500":"border-l-4 border-l-transparent"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-1.5 py-0.5 rounded uppercase ${v.priority==="CRITICAL"?"bg-red-500/20 text-red-400":"bg-slate-700 text-slate-300"}`,children:v.category||v.priority}),e.jsx("span",{className:"text-[10px] text-slate-500",children:new Date(v.createdAt).toLocaleDateString()})]}),e.jsx("h4",{className:`text-sm font-bold mb-1 truncate ${v.status==="RESOLVED"?"text-slate-500 line-through":"text-white"}`,children:v.subject}),e.jsx("p",{className:"text-xs text-slate-400 truncate",children:v.schoolName})]},v.id))]})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-6",children:[e.jsx("div",{className:"bg-slate-900 border border-slate-800 rounded-xl overflow-hidden flex flex-col relative h-2/3",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 bg-slate-900",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-1",children:a.subject}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"w-3 h-3"})," ",a.userEmail]}),e.jsx("span",{className:"w-1 h-1 bg-slate-600 rounded-full"}),e.jsx("span",{children:a.schoolName})]})]}),e.jsx("div",{className:`px-3 py-1 rounded text-xs font-bold ${a.status==="OPEN"?"bg-green-500/20 text-green-400":"bg-slate-700 text-slate-300"}`,children:a.status})]}),e.jsx("div",{className:"bg-slate-800/50 p-4 rounded-lg text-sm text-slate-300 leading-relaxed max-h-32 overflow-y-auto custom-scrollbar",children:a.message})]}),a.category==="BUG"&&a.status!=="RESOLVED"&&e.jsxs("div",{className:"px-6 py-3 bg-red-900/10 border-b border-red-900/30 flex items-center gap-4",children:[e.jsxs("span",{className:"text-xs font-bold text-red-400 flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"})," Quick Fixes:"]}),e.jsxs("button",{onClick:L,disabled:i,className:"text-[10px] bg-red-900/30 hover:bg-red-900/50 text-red-300 px-2 py-1 rounded border border-red-800 flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3"})," Fix Schema/Tables"]}),e.jsxs("button",{onClick:I,disabled:i,className:"text-[10px] bg-orange-900/30 hover:bg-orange-900/50 text-orange-300 px-2 py-1 rounded border border-orange-800 flex items-center gap-1",children:[e.jsx(q,{className:"w-3 h-3"})," Clear Server Cache"]})]}),a.status!=="RESOLVED"&&e.jsxs("div",{className:"p-6 flex-1 flex flex-col",children:[a.aiSuggestedReply&&e.jsxs("div",{className:"bg-purple-900/10 border border-purple-500/30 p-3 rounded-lg mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-purple-400 text-xs font-bold uppercase",children:[e.jsx(as,{className:"w-4 h-4"})," AI Auto-Draft"]}),e.jsxs("p",{className:"text-sm text-slate-300 italic line-clamp-2",children:['"',a.aiSuggestedReply,'"']}),e.jsx("button",{onClick:()=>N(a.aiSuggestedReply||""),className:"mt-2 text-xs text-purple-400 hover:text-purple-300 underline",children:"Use this reply"})]}),e.jsx("textarea",{className:"w-full flex-1 bg-slate-800 border border-slate-700 rounded-xl p-4 text-white resize-none focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Type your reply here...",value:d,onChange:v=>N(v.target.value)}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx(U,{onClick:b,disabled:r,className:"bg-blue-600 hover:bg-blue-700 flex items-center gap-2",children:r?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-4 h-4"})," Approve & Send Reply"]})})})]}),a.status==="RESOLVED"&&e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-500",children:[e.jsx(De,{className:"w-16 h-16 mb-4 text-green-900"}),e.jsx("p",{children:"This ticket has been resolved."})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-slate-600",children:[e.jsx(_e,{className:"w-20 h-20 mb-4 opacity-20"}),e.jsx("p",{children:"Select a ticket to view details"})]})}),e.jsxs("div",{className:"h-1/3 bg-slate-900 border border-slate-800 rounded-xl p-6",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-orange-500"})," Advanced Troubleshooting"]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"bg-slate-950 p-4 rounded-lg border border-slate-800",children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-2 flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4 text-red-500"})," Account Fixer"]}),e.jsx("p",{className:"text-xs text-slate-500 mb-3",children:'Fix "Profile Not Found" errors by resetting Auth.'}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 bg-slate-800 border border-slate-700 rounded px-3 py-1.5 text-xs text-white",placeholder:"Enter user email...",value:l,onChange:v=>p(v.target.value)}),e.jsx("button",{onClick:E,disabled:j,className:"bg-red-900/30 text-red-400 border border-red-900/50 px-3 py-1.5 rounded text-xs font-bold hover:bg-red-900/50 flex items-center gap-1",children:j?"Fixing...":e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-3 h-3"})," Reset"]})})]})]})})]})]})]})},He=`
-- 1. UUID Extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- 2. Fix AFFILIATES Table (Add Recovery Code)
CREATE TABLE IF NOT EXISTS affiliates (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT NOT NULL,
    phone TEXT,
    code TEXT UNIQUE NOT NULL,
    earnings INTEGER DEFAULT 0,
    schools_referred INTEGER DEFAULT 0,
    wallet_balance INTEGER DEFAULT 0,
    plan_config JSONB DEFAULT '{"mode": "PAY_PER_UNIT", "costPerUnit": 0, "resultPublishCost": 1}',
    recovery_code TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
ALTER TABLE affiliates ADD COLUMN IF NOT EXISTS recovery_code TEXT;

-- 3. Fix SCHOOLS Table
ALTER TABLE schools ADD COLUMN IF NOT EXISTS search_config JSONB DEFAULT '{"mode": "SEARCH", "searchFields": [{"label": "Register No", "columnName": "RegNo", "type": "text"}]}';
ALTER TABLE schools ADD COLUMN IF NOT EXISTS sheet_url TEXT;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS logo_url TEXT;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS referral_code TEXT;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS wallet_balance INTEGER DEFAULT 0;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS result_display_type JSONB;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS referred_by_school_id UUID;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS referral_source TEXT;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS principal_email TEXT;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS has_principal_login BOOLEAN DEFAULT FALSE;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS enable_ai_remarks BOOLEAN DEFAULT TRUE;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS enable_ai_voice BOOLEAN DEFAULT TRUE;
ALTER TABLE schools ADD COLUMN IF NOT EXISTS enable_ai_prediction BOOLEAN DEFAULT TRUE;

-- 4. Fix PARTNER UPDATE Function
DROP FUNCTION IF EXISTS update_school_by_partner;

CREATE OR REPLACE FUNCTION update_school_by_partner(
    p_code TEXT,
    s_id UUID,
    s_name TEXT,
    s_place TEXT,
    s_sheet_url TEXT,
    s_logo_url TEXT,
    s_search_config JSONB,
    s_result_display_type JSONB,
    s_ai_remarks BOOLEAN
)
RETURNS JSONB AS $$
DECLARE
    target_school RECORD;
BEGIN
    SELECT * INTO target_school FROM schools WHERE id = s_id AND referral_code = p_code;
    
    IF target_school.id IS NULL THEN
        RETURN jsonb_build_object('success', false, 'message', 'Unauthorized');
    END IF;

    UPDATE schools SET
        name = COALESCE(s_name, name),
        place = COALESCE(s_place, place),
        sheet_url = COALESCE(s_sheet_url, sheet_url),
        logo_url = COALESCE(s_logo_url, logo_url),
        search_config = COALESCE(s_search_config, search_config),
        result_display_type = COALESCE(s_result_display_type, result_display_type),
        enable_ai_remarks = COALESCE(s_ai_remarks, enable_ai_remarks)
    WHERE id = s_id;

    RETURN jsonb_build_object('success', true);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 5. Fix Wallet Increment
CREATE OR REPLACE FUNCTION increment_partner_wallet(p_id UUID, amt INTEGER)
RETURNS VOID AS $$
BEGIN
    UPDATE affiliates SET wallet_balance = COALESCE(wallet_balance, 0) + amt WHERE id = p_id;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 6. Setup Exec SQL
CREATE OR REPLACE FUNCTION exec_sql(sql_query TEXT)
RETURNS JSONB AS $$
BEGIN
    EXECUTE sql_query;
    RETURN jsonb_build_object('success', true);
EXCEPTION WHEN OTHERS THEN
    RETURN jsonb_build_object('success', false, 'message', SQLERRM);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 7. Atomic Create Function for Partner Schools
CREATE OR REPLACE FUNCTION create_partner_school_atomic(
    p_id UUID,
    s_name TEXT,
    s_place TEXT,
    s_sheet_url TEXT,
    cost_in INTEGER
)
RETURNS JSONB AS $$
DECLARE
    partner_rec RECORD;
    new_school_id UUID;
    p_code TEXT;
BEGIN
    SELECT * INTO partner_rec FROM affiliates WHERE id = p_id;
    
    IF partner_rec.wallet_balance < cost_in THEN
        RETURN jsonb_build_object('success', false, 'message', 'Insufficient Wallet Balance');
    END IF;
    
    p_code := partner_rec.code;

    INSERT INTO schools (name, place, sheet_url, referral_code, is_pro, admin_email)
    VALUES (s_name, s_place, s_sheet_url, p_code, true, 'partner_managed@resultmate.com')
    RETURNING id INTO new_school_id;

    IF cost_in > 0 THEN
        UPDATE affiliates SET wallet_balance = wallet_balance - cost_in WHERE id = p_id;
        
        INSERT INTO credit_transactions_v2 (school_id, amount, type, description, category, user_id)
        VALUES ('00000000-0000-0000-0000-000000000000', -cost_in, 'DEBIT', 'Created School: ' || s_name, 'PARTNER_WALLET', p_id);
    END IF;

    RETURN jsonb_build_object('success', true, 'schoolId', new_school_id);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
`,Xe=He,Re={schools:["id","name","auth_id","admin_email","phone","place","is_pro","wallet_balance","search_config","sheet_url","logo_url","referral_code","result_display_type","principal_email","has_principal_login","referred_by_school_id","referral_source","enable_ai_remarks"],students:["id","school_id","class_id","name","reg_no","dob","gender","is_verified","is_archived","social_links","added_by"],classes:["id","school_id","name","teacher_name","status","subjects"],marks:["student_id","term","subjects","total","grade"],fee_structures:["id","school_id","name","amount","due_date"],fee_payments:["id","fee_id","student_id","amount_paid","status"],affiliates:["id","name","email","code","wallet_balance","plan_config","recovery_code"],credit_transactions_v2:["id","school_id","amount","type","category"],app_config:["key","value"],campus_posts:["id","school_id","message","likes"],ad_campaigns:["id","image_url","target_url","is_active"],staff_members:["id","name","email","role"],timetable_config:["school_id","working_days","day_starts_at"],timetable_entries:["school_id","class_id","day","period_index"],academic_calendar:["id","school_id","date","title","type"],school_syllabi:["id","name","subjects"],audit_logs:["id","school_id","action","entity_type"],system_feedback:["id","message","type","status"],question_bank:["id","text","options","correct_option_index"],profile_requests:["id","student_id","field","new_value"],notifications:["id","school_id","title","message"],attendance:["id","student_id","date","status","type"],payment_proofs:["id","amount","transaction_ref","status","partner_id"]},Js=s=>{let n=`-- Auto-Generated Fix Script

`;return new Set(s.map(f=>f.table)).forEach(f=>{const a=s.filter(m=>m.table===f).map(m=>m.column);a.some(m=>m.includes("(Whole Table)"))?n+=`-- Missing Table: ${f}. Please run the MASTER SETUP SCRIPT to create tables.
`:(n+=`-- Fixes for ${f}
`,a.forEach(m=>{let d="TEXT";(m.includes("balance")||m.includes("amount")||m.includes("count"))&&(d="INTEGER DEFAULT 0"),(m.includes("is_")||m.includes("has_"))&&(d="BOOLEAN DEFAULT FALSE"),(m.includes("json")||m.includes("config")||m.includes("subjects"))&&(d="JSONB"),(m.includes("date")||m.includes("at"))&&(d="TIMESTAMP WITH TIME ZONE"),m.includes("_id")&&(d="UUID"),n+=`ALTER TABLE ${f} ADD COLUMN IF NOT EXISTS ${m} ${d};
`})),n+=`
`}),n},Qs=()=>{const[s,n]=t.useState({}),[w,f]=t.useState(!0),[a,m]=t.useState("DISCONNECTED"),[d,N]=t.useState(""),[r,h]=t.useState(""),[l,p]=t.useState(!1),[j,C]=t.useState(""),[i,g]=t.useState(""),[S,_]=t.useState(""),[b,E]=t.useState(!1),[L,I]=t.useState(""),[v,M]=t.useState(""),[F,V]=t.useState(""),[o,T]=t.useState({exams:0,results:1,ai:5,assessments:0,timetable:0,calendar:0}),[k,$]=t.useState(1),[H,W]=t.useState(2),[se,z]=t.useState(20),[te,ae]=t.useState(50),[le,re]=t.useState(100),[ne,ce]=t.useState("ResultMate"),[x,A]=t.useState("support@resultmate.com"),[R,O]=t.useState(""),[G,Y]=t.useState(""),[Ve,Ye]=t.useState({commission:500,discountPercent:10}),[ht,qe]=t.useState(""),[ut,bt]=t.useState(""),[pt,gt]=t.useState(!1);t.useEffect(()=>{m(rs()?"CONNECTED":"DISCONNECTED");const c=ns();c.url&&!c.url.includes("placeholder")&&(N(c.url),h(c.key)),Ke()},[]);const Ke=async()=>{try{const c=await u.getGlobalSettings();if(n(c),c.CASHFREE_APP_ID&&C(c.CASHFREE_APP_ID),c.CASHFREE_SECRET_KEY&&g(c.CASHFREE_SECRET_KEY),c.RAZORPAY_KEY_ID&&_(c.RAZORPAY_KEY_ID),c.GPAY_CONFIG)try{const D=JSON.parse(c.GPAY_CONFIG);I(D.qrUrl||""),M(D.vpa||""),V(D.whatsappNumber||"")}catch{}if(c.FEATURE_COSTS)try{const D=JSON.parse(c.FEATURE_COSTS);"sms"in D&&delete D.sms,T(J=>({...J,...D}))}catch{}if(c.CREDIT_BASE_PRICE&&$(parseFloat(c.CREDIT_BASE_PRICE)),c.AI_TRIAL_LIMIT&&W(parseInt(c.AI_TRIAL_LIMIT)),c.STUDENT_PREMIUM_FEE&&z(parseInt(c.STUDENT_PREMIUM_FEE)),c.MIN_RECHARGE_LIMIT&&ae(parseInt(c.MIN_RECHARGE_LIMIT)),c.SIGNUP_BONUS_CREDITS&&re(parseInt(c.SIGNUP_BONUS_CREDITS)),c.PLATFORM_NAME&&ce(c.PLATFORM_NAME),c.SUPPORT_EMAIL&&A(c.SUPPORT_EMAIL),c.SUPPORT_PHONE&&O(c.SUPPORT_PHONE),c.SHEET_TEMPLATE_URL&&Y(c.SHEET_TEMPLATE_URL),c.AFFILIATE_CONFIG)try{Ye(JSON.parse(c.AFFILIATE_CONFIG))}catch{}c.SUPER_ADMIN_EMAIL&&qe(c.SUPER_ADMIN_EMAIL)}catch(c){console.error("Failed to load settings",c)}f(!1)},ze=async c=>{const J=s[c]==="TRUE"?"FALSE":"TRUE";n({...s,[c]:J}),await u.updateGlobalSetting(c,J)},Je=async c=>{const D=c.target.value;n({...s,ACTIVE_PAYMENT_GATEWAY:D}),await u.updateGlobalSetting("ACTIVE_PAYMENT_GATEWAY",D)},Qe=async c=>{const D=c.target.value;n({...s,PAYMENT_MODE:D}),await u.updateGlobalSetting("PAYMENT_MODE",D)},Ze=async()=>{E(!0),await u.updateGlobalSetting("CASHFREE_APP_ID",j),await u.updateGlobalSetting("CASHFREE_SECRET_KEY",i),await u.updateGlobalSetting("RAZORPAY_KEY_ID",S),await u.updateGlobalSetting("GPAY_CONFIG",JSON.stringify({qrUrl:L,vpa:v,whatsappNumber:F})),await u.updateGlobalSetting("FEATURE_COSTS",JSON.stringify(o)),await u.updateGlobalSetting("CREDIT_BASE_PRICE",k.toString()),await u.updateGlobalSetting("AI_TRIAL_LIMIT",H.toString()),await u.updateGlobalSetting("STUDENT_PREMIUM_FEE",se.toString()),await u.updateGlobalSetting("MIN_RECHARGE_LIMIT",te.toString()),await u.updateGlobalSetting("SIGNUP_BONUS_CREDITS",le.toString()),await u.updateGlobalSetting("PLATFORM_NAME",ne),await u.updateGlobalSetting("SUPPORT_EMAIL",x),await u.updateGlobalSetting("SUPPORT_PHONE",R),await u.updateGlobalSetting("SHEET_TEMPLATE_URL",G),await u.updateGlobalSetting("AFFILIATE_CONFIG",JSON.stringify(Ve)),E(!1),alert("Settings Updated in Database.")},es=()=>{if(!d||!r)return alert("URL & Key required");os(d,r),alert("Database connection updated! Reloading..."),window.location.reload()},ss=async()=>{if(!confirm("This will attempt to run the SCHEMA_FIX script via RPC. If this fails, please run the SQL manually in Supabase."))return;p(!0);const c=await u.runDatabaseMigration(Xe);p(!1),c.success?alert("✅ Schema Repair Executed! Ask Partner to try saving again."):alert("❌ Automated Fix Failed: "+c.message+`

Please copy the SQL from 'Infrastructure > SQL Patcher' and run it manually in Supabase.`)};if(w)return e.jsx("div",{className:"p-8 text-white",children:"Loading Controls..."});const ts=({label:c,keyName:D,desc:J})=>{const Ne=s[D]==="TRUE";return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-900 border border-slate-800 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("h4",{className:`font-bold ${Ne?"text-white":"text-slate-500"}`,children:c}),e.jsx("p",{className:"text-xs text-slate-500",children:J})]}),e.jsx("button",{onClick:()=>ze(D),className:`relative w-12 h-7 rounded-full transition-colors ${Ne?"bg-green-500":"bg-slate-700"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-5 h-5 bg-white rounded-full transition-transform ${Ne?"translate-x-5":"translate-x-0"}`})})]})};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8 animate-fade-in-up pb-20",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-green-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"})," Database Cluster"]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${a==="CONNECTED"?"bg-green-500 animate-pulse":"bg-red-500"}`}),e.jsxs("span",{className:"text-white font-bold text-sm",children:["Status: ",a]})]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Supabase / Postgres"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase block mb-1",children:"Project URL"}),e.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm font-mono",value:d,onChange:c=>N(c.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase block mb-1",children:"API Key (anon)"}),e.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm font-mono",type:"password",value:r,onChange:c=>h(c.target.value)})]})]}),e.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[e.jsxs("button",{onClick:ss,disabled:l,className:"bg-red-900/30 text-red-400 border border-red-900/50 hover:bg-red-900/50 px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2",children:[l?e.jsx(X,{className:"w-3 h-3 animate-spin"}):e.jsx(ke,{className:"w-3 h-3"}),"Emergency Schema Fix"]}),e.jsxs("button",{onClick:es,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-bold text-sm flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"})," Connect"]})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-2",children:`* Use 'Emergency Schema Fix' if Partners see "Configuration Not Found".`})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-yellow-400 uppercase tracking-wider flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"})," Payment & Economy"]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase block mb-2",children:"Active Provider"}),e.jsxs("select",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm outline-none focus:ring-2 focus:ring-yellow-600",value:s.ACTIVE_PAYMENT_GATEWAY||"NONE",onChange:Je,children:[e.jsx("option",{value:"NONE",children:"Disabled (Manual Only)"}),e.jsx("option",{value:"CASHFREE",children:"Cashfree Payments"}),e.jsx("option",{value:"RAZORPAY",children:"Razorpay"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase block mb-2",children:"Environment"}),e.jsxs("select",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm outline-none focus:ring-2 focus:ring-yellow-600",value:s.PAYMENT_MODE||"SANDBOX",onChange:Qe,children:[e.jsx("option",{value:"SANDBOX",children:"Sandbox (Test Mode)"}),e.jsx("option",{value:"LIVE",children:"Live (Production)"})]})]})]}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 mb-6",children:[e.jsxs("h4",{className:"text-white font-bold text-sm flex items-center gap-2 mb-3",children:[e.jsx(Cs,{className:"w-4 h-4 text-pink-500"})," Branding & Resources"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Platform Name"}),e.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm",value:ne,onChange:c=>ce(c.target.value)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-slate-500 uppercase block mb-1 flex items-center gap-1",children:[e.jsx(cs,{className:"w-3 h-3"})," Google Sheet Template (Public Link)"]}),e.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm",placeholder:"https://docs.google.com/...",value:G,onChange:c=>Y(c.target.value)})]})]})]}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 mt-4 border-l-4 border-l-purple-500",children:[e.jsxs("h4",{className:"text-white font-bold text-sm flex items-center gap-2 mb-3",children:[e.jsx(we,{className:"w-4 h-4 text-purple-500"})," Economy Engine"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-[10px] text-yellow-500 uppercase block mb-1 font-bold flex items-center gap-1",children:[e.jsx(is,{className:"w-3 h-3"})," Signup Bonus (CR)"]}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold focus:border-yellow-500 focus:ring-1 focus:ring-yellow-500",value:le,onChange:c=>re(parseInt(c.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-purple-300 uppercase block mb-1",children:"Base Price (₹/CR)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:k,onChange:c=>$(parseFloat(c.target.value)||1),step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Student Premium (₹)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:se,onChange:c=>z(parseInt(c.target.value)||0)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Min Recharge (CR)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:te,onChange:c=>ae(parseInt(c.target.value)||0)})]})]}),e.jsx("h5",{className:"text-[10px] font-bold text-slate-500 uppercase mb-2",children:"Feature Credit Costs (0 = Free)"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Result (Per Student)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:o.results,onChange:c=>T({...o,results:parseInt(c.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Exam (Create)"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:o.exams,onChange:c=>T({...o,exams:parseInt(c.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"AI Generation"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:o.ai,onChange:c=>T({...o,ai:parseInt(c.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Assessment Program"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:o.assessments||0,onChange:c=>T({...o,assessments:parseInt(c.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Timetable Gen"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:o.timetable||0,onChange:c=>T({...o,timetable:parseInt(c.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase block mb-1",children:"Calendar Event"}),e.jsx("input",{type:"number",className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-white text-sm text-center font-bold",value:o.calendar||0,onChange:c=>T({...o,calendar:parseInt(c.target.value)||0})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx(ts,{label:"Mock Payment Mode",keyName:"ENABLE_MOCK_PAYMENTS",desc:"Allow fake payments for testing"}),e.jsx("button",{onClick:Ze,disabled:b,className:"bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2.5 rounded-lg font-bold text-sm flex items-center gap-2",children:b?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"})," Update Configuration"]})})]})]})]})]})},Zs=()=>{const[s,n]=t.useState("OVERVIEW"),[w,f]=t.useState([]),[a,m]=t.useState(""),[d,N]=t.useState(!1),[r,h]=t.useState(""),[l,p]=t.useState([]),[j,C]=t.useState(!1),[i,g]=t.useState(null),[S,_]=t.useState(null),[b,E]=t.useState(!1),[L,I]=t.useState(null);t.useEffect(()=>{v()},[]);const v=async()=>{const o=await u.getStoragePoolStatus();f(o)},M=async()=>{C(!0),p([]);try{const o=[];for(const[T,k]of Object.entries(Re)){const{data:$,error:H}=await ye.from(T).select("*").limit(1);if(H)H.code==="42P01"?k.forEach(W=>o.push({table:T,column:`(Whole Table) ${W}`})):console.warn(`Could not scan table ${T}:`,H.message);else{const{error:W}=await ye.from(T).select(k.join(",")).limit(1);W&&o.push({table:T,column:"One or more columns missing"})}}if(p(o),o.length>0){const T=[];o.forEach($=>{const H=Re[$.table];H&&H.forEach(W=>T.push({table:$.table,column:W}))});const k=Js(T);m(k)}else m("-- System Healthy. No missing columns detected.")}catch(o){console.error("Scan failed",o)}C(!1),g(new Date)},F=async()=>{if(!a.trim())return;N(!0);const o=await u.runDatabaseMigration(a);N(!1),h(o.message||"Done"),o.success&&M(),setTimeout(()=>h(""),5e3)},V=async o=>{if(!confirm("Attempt auto-fix? This will clean up orphaned records."))return;I(o);const T=await u.runAutoFix(o);if(I(null),T.success){alert(`Fix applied. Cleaned ${T.fixed_count||0} records.`);const k=await u.getSystemHealthReport();_(k)}else alert("Fix failed: "+T.message)};if(s==="SYSTEM_DOCTOR"){const o=async()=>{E(!0),_(null),setTimeout(async()=>{const T=await u.getSystemHealthReport();_(T),E(!1)},1500)};return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:()=>n("OVERVIEW"),className:"p-2 bg-slate-800 rounded-full hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(je,{className:"w-6 h-6 text-green-500"})," System Doctor"]}),e.jsx("p",{className:"text-xs text-slate-500",children:"AI-Powered Health Check & Repair"})]})]}),e.jsxs("div",{className:"flex justify-center mb-8",children:[!S&&!b&&e.jsxs("div",{className:"text-center py-20",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-900 rounded-full flex items-center justify-center mx-auto mb-6 border-4 border-slate-800",children:e.jsx(Z,{className:"w-10 h-10 text-slate-600"})}),e.jsx("h3",{className:"text-white text-lg font-bold mb-2",children:"System Ready for Scan"}),e.jsx(U,{onClick:o,className:"bg-green-600 hover:bg-green-700 text-white px-8 py-3 text-sm font-bold shadow-lg shadow-green-500/20",children:"Start Smart Scan"})]}),b&&e.jsxs("div",{className:"text-center py-20",children:[e.jsxs("div",{className:"relative w-24 h-24 mx-auto mb-6",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-slate-800 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-4 border-t-green-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(je,{className:"w-8 h-8 text-green-500 animate-pulse"})})]}),e.jsx("h3",{className:"text-white text-lg font-bold animate-pulse",children:"Scanning System..."})]}),S&&e.jsxs("div",{className:"w-full max-w-4xl grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{className:`border-l-4 ${S.ghost_students>0?"border-red-500 bg-red-900/10":"border-green-500 bg-slate-900"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-bold flex items-center gap-2",children:[e.jsx(Fs,{className:`w-5 h-5 ${S.ghost_students>0?"text-red-500":"text-green-500"}`}),"Ghost Students"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Students linked to deleted schools."})]}),e.jsx("span",{className:`text-2xl font-black ${S.ghost_students>0?"text-red-500":"text-green-500"}`,children:S.ghost_students})]}),S.ghost_students>0?e.jsx("button",{onClick:()=>V("GHOST_STUDENTS"),disabled:!!L,className:"mt-4 w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded text-xs font-bold transition-colors",children:"Fix Now"}):e.jsx("div",{className:"mt-4 py-2 text-center text-xs text-green-500 font-bold bg-green-900/20 rounded",children:"System Healthy"})]}),e.jsx("div",{className:"flex items-center justify-center col-span-full mt-4",children:e.jsxs("button",{onClick:o,className:"text-slate-500 hover:text-white flex items-center gap-2 text-sm font-bold bg-slate-800 px-4 py-2 rounded-lg transition-colors",children:[e.jsx(X,{className:"w-4 h-4"})," Re-Scan"]})})]})]})]})}return s==="DB_DETAILS"?e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:()=>n("OVERVIEW"),className:"p-2 bg-slate-800 rounded-full hover:bg-slate-700 text-slate-400 hover:text-white transition-colors",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Schema Control"}),e.jsx("p",{className:"text-xs text-slate-500",children:"Auto-Detect & Fix Missing Columns"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-blue-500"})," Diagnosis"]}),e.jsxs("button",{onClick:M,disabled:j,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-xs font-bold flex items-center gap-2 shadow-lg shadow-blue-500/20",children:[e.jsx(X,{className:`w-4 h-4 ${j?"animate-spin":""}`}),j?"Scanning...":"Run Full Scan"]})]}),e.jsx("div",{className:"flex-1 bg-slate-950 rounded-xl p-4 border border-slate-800 overflow-y-auto max-h-[300px] mb-4",children:j?e.jsxs("div",{className:"text-center py-10 text-slate-500",children:[e.jsx(Z,{className:"w-8 h-8 mx-auto mb-2 animate-bounce"}),e.jsx("p",{children:"Scanning Tables..."})]}):l.length>0?e.jsx("div",{className:"space-y-2",children:l.map((o,T)=>e.jsxs("div",{className:"flex items-start gap-2 text-xs p-2 bg-red-900/10 border border-red-900/30 rounded text-red-300",children:[e.jsx(ds,{className:"w-4 h-4 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold block text-red-200",children:o.table}),e.jsxs("span",{className:"opacity-80",children:["Issue: ",o.column]})]})]},T))}):i?e.jsxs("div",{className:"text-center py-10 text-green-500",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto mb-2"}),e.jsx("p",{className:"font-bold",children:"System Healthy"}),e.jsx("p",{className:"text-xs opacity-70",children:"100% Schema Match"})]}):e.jsxs("div",{className:"text-center py-10 text-slate-600",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 opacity-20"}),e.jsx("p",{children:'Click "Run Full Scan" to check database health.'})]})})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800 h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(Hs,{className:"w-4 h-4 text-orange-500"})," SQL Patcher"]}),l.length>0&&e.jsx("span",{className:"text-[10px] bg-orange-900/30 text-orange-400 px-2 py-1 rounded border border-orange-900/50",children:"Fix Available"})]}),e.jsx("textarea",{className:"flex-1 bg-slate-950 font-mono text-[10px] text-green-400 p-3 rounded-lg border border-slate-800 outline-none resize-none mb-4 custom-scrollbar",placeholder:"-- Fix script will be generated here...",value:a,readOnly:!0}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`text-xs font-mono truncate max-w-[150px] ${r.includes("Success")?"text-green-500":"text-red-500"}`,children:r}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(He),className:"text-xs text-slate-500 hover:text-white px-3 py-2",children:"Reset DB Script"}),e.jsx(U,{onClick:F,disabled:d||!a||a.startsWith("-- System Healthy"),className:"bg-orange-600 hover:bg-orange-700 text-xs py-2 shadow-lg shadow-orange-900/20",children:d?"Applying...":e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-3 h-3 mr-1"})," Auto-Fix Issues"]})})]})]})]})]})]}):e.jsx("div",{className:"space-y-8 animate-fade-in-up",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{onClick:()=>n("SYSTEM_DOCTOR"),className:"bg-slate-900 border border-slate-800 p-6 rounded-2xl hover:border-green-500 cursor-pointer group transition-all relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity",children:e.jsx(je,{className:"w-16 h-16 text-green-500"})}),e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:"p-3 bg-green-900/20 rounded-xl text-green-400 group-hover:scale-110 transition-transform",children:e.jsx(Z,{className:"w-8 h-8"})})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"System Doctor"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"Fix logical data errors (Ghosts, Orphans)."})]}),e.jsxs("div",{onClick:()=>n("DB_DETAILS"),className:"bg-slate-900 border border-slate-800 p-6 rounded-2xl hover:border-blue-500 cursor-pointer group transition-all",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:"p-3 bg-blue-900/20 rounded-xl text-blue-400 group-hover:scale-110 transition-transform",children:e.jsx(K,{className:"w-8 h-8"})})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Schema Scanner"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"100% Column Verification & Auto-Fix."}),e.jsx("div",{className:"flex items-center gap-2 text-[10px] font-mono text-blue-400",children:"New: Full Coverage"})]}),e.jsxs("div",{onClick:()=>n("STORAGE_DETAILS"),className:"bg-slate-900 border border-slate-800 p-6 rounded-2xl hover:border-purple-500 cursor-pointer group transition-all",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:"p-3 bg-purple-900/20 rounded-xl text-purple-400 group-hover:scale-110 transition-transform",children:e.jsx(Ds,{className:"w-8 h-8"})})}),e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Storage Mesh"}),e.jsx("p",{className:"text-sm text-slate-500 mb-4",children:"CDN & File Nodes."})]})]})})},et=()=>{const[s,n]=t.useState("LIST"),[w,f]=t.useState([]),[a,m]=t.useState(null),[d,N]=t.useState(!1),[r,h]=t.useState({name:"",email:"",role:"SUPPORT"}),[l,p]=t.useState(!1);t.useEffect(()=>{j()},[]);const j=async()=>{const g=await u.getStaffList();f(g)},C=g=>{m(g),n("DETAIL")},i=async g=>{g.preventDefault(),p(!0);const S=await u.addStaffMember(r);p(!1),S.success?(N(!1),h({name:"",email:"",role:"SUPPORT"}),j(),alert("Staff member added successfully!")):alert("Failed to add staff: "+S.message)};return s==="DETAIL"&&a?e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsxs("button",{onClick:()=>n("LIST"),className:"mb-6 flex items-center gap-2 text-slate-400 hover:text-white transition-colors",children:[e.jsx(de,{className:"w-4 h-4"})," Back to Team"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800 flex flex-col items-center text-center py-8",children:[e.jsx("div",{className:"w-24 h-24 bg-slate-800 rounded-full flex items-center justify-center font-black text-3xl text-slate-500 mb-4 border-4 border-slate-700 shadow-xl",children:a.name.substring(0,2).toUpperCase()}),e.jsx("h2",{className:"text-2xl font-bold text-white mb-1",children:a.name}),e.jsx("span",{className:"bg-blue-900/30 text-blue-400 px-3 py-1 rounded-full text-xs font-bold mb-6 border border-blue-900/50",children:a.role}),e.jsxs("div",{className:"w-full border-t border-slate-800 pt-6 flex justify-around",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase font-bold mb-1",children:"Status"}),e.jsxs("div",{className:`flex items-center justify-center gap-1 text-sm font-bold ${a.status==="ONLINE"?"text-green-500":"text-slate-400"}`,children:[e.jsx(Ae,{className:"w-2 h-2 fill-current"})," ",a.status]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 uppercase font-bold mb-1",children:"Rating"}),e.jsxs("p",{className:"text-sm font-bold text-white",children:[a.performance,"%"]})]})]})]}),e.jsx("div",{className:"md:col-span-2 space-y-6",children:e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsx("h3",{className:"font-bold text-white mb-4",children:"Performance Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 mb-2",children:[e.jsx(De,{className:"w-4 h-4"})," Tickets Closed"]}),e.jsx("p",{className:"text-2xl font-black text-white",children:"0"})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 mb-2",children:[e.jsx(xe,{className:"w-4 h-4"})," Avg Response"]}),e.jsx("p",{className:"text-2xl font-black text-white",children:"--"})]})]})]})})]})]}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ue,{className:"w-6 h-6 text-blue-500"})," Team Management"]}),e.jsxs(U,{onClick:()=>N(!0),className:"bg-blue-600 hover:bg-blue-700 text-xs flex items-center gap-2 text-white",children:[e.jsx(Se,{className:"w-4 h-4"})," Add Staff"]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:[w.length===0&&e.jsx("div",{className:"col-span-full py-12 text-center text-slate-500 border-2 border-dashed border-slate-800 rounded-xl",children:"No staff members found. Add one to get started."}),w.map(g=>e.jsxs(y,{className:"bg-slate-900 border-slate-800 relative group hover:border-blue-500/30 transition-all cursor-pointer",onClick:()=>C(g),children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-800 rounded-full flex items-center justify-center font-bold text-slate-400 group-hover:bg-blue-900/30 group-hover:text-blue-400 transition-colors border border-slate-700",children:g.name.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white text-sm",children:g.name}),e.jsxs("p",{className:"text-xs text-blue-400 flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"})," ",g.role]})]})]}),e.jsxs("div",{className:`flex items-center gap-1 text-[10px] font-bold ${g.status==="ONLINE"?"text-green-500":"text-slate-500"}`,children:[e.jsx(Ae,{className:"w-2 h-2 fill-current"})," ",g.status]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-end mb-1",children:[e.jsxs("span",{className:"text-[10px] text-slate-500 font-bold uppercase flex items-center gap-1",children:[e.jsx($e,{className:"w-3 h-3"})," Performance"]}),e.jsxs("span",{className:"text-xs font-mono text-white",children:[g.performance,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-800 h-1.5 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${g.performance>90?"bg-green-500":"bg-yellow-500"}`,style:{width:`${g.performance}%`}})})]})]},g.id))]}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 animate-fade-in-up",children:e.jsxs(y,{className:"w-full max-w-md bg-slate-900 border border-slate-700 relative shadow-2xl",children:[e.jsx("button",{onClick:()=>N(!1),className:"absolute top-4 right-4 text-slate-400 hover:text-white",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsxs("h3",{className:"text-lg font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-500"})," Add Team Member"]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:"Full Name"}),e.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-white text-sm focus:border-blue-500 outline-none",value:r.name,onChange:g=>h({...r,name:g.target.value}),placeholder:"e.g. John Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:"Email"}),e.jsx("input",{type:"email",className:"w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-white text-sm focus:border-blue-500 outline-none",value:r.email,onChange:g=>h({...r,email:g.target.value}),placeholder:"staff@resultmate.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase block mb-1",children:"Role"}),e.jsxs("select",{className:"w-full bg-slate-950 border border-slate-700 rounded-lg p-3 text-white text-sm focus:border-blue-500 outline-none appearance-none",value:r.role,onChange:g=>h({...r,role:g.target.value}),children:[e.jsx("option",{value:"SUPPORT",children:"Support Agent"}),e.jsx("option",{value:"MANAGER",children:"Manager"}),e.jsx("option",{value:"DEVELOPER",children:"Developer"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx(U,{type:"submit",disabled:l,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3",children:l?"Creating Account...":"Create Account"})})]})]})})]})},st=()=>{const[s,n]=t.useState(null),[w,f]=t.useState(!0),[a,m]=t.useState(!1),d=["Unlimited Students","Smart Data Entry (Public Link)","Instant Result Publish","WhatsApp Viral Result Link","Data Backup & Export","Fee Management System","Fee Receipts & Reports","School Branding (Logo)","No Ads on Results","✨ AI Question Generator","📱 White-label Mobile App","Behavioral Reports","Priority Support","Multiple Admin Logins"];t.useEffect(()=>{N()},[]);const N=async()=>{const l=await u.getMarketingConfig();n(l),f(!1)},r=async()=>{s&&(m(!0),await u.updateMarketingConfig(s),m(!1),alert("Marketing & Plan settings updated!"))},h=(l,p)=>{if(!s||!s.planFeatures)return;const j=s.planFeatures[l];let C;j.includes(p)?C=j.filter(i=>i!==p):C=[...j,p],n({...s,planFeatures:{...s.planFeatures,[l]:C}})};return w||!s?e.jsx("div",{children:"Loading Command Center..."}):e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8 animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Oe,{className:"w-6 h-6 text-yellow-500"})," Marketing Command Center"]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Control Pricing, Offers & Plan Features"})]}),e.jsx(U,{onClick:r,disabled:a,className:"bg-green-600 hover:bg-green-700",children:a?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"})," Save Changes"]})})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5 text-orange-500"})," Flash Sale Engine"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-white font-bold",children:"Activate Flash Sale"}),e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-orange-500",checked:s.flashSaleActive,onChange:l=>n({...s,flashSaleActive:l.target.checked})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold block mb-1",children:"Countdown End Time"}),e.jsx(B,{type:"datetime-local",value:s.flashSaleEndTime||"",onChange:l=>n({...s,flashSaleEndTime:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold block mb-1",children:"Banner Text"}),e.jsx(B,{placeholder:"Monsoon Offer: 50% OFF Ends Soon!",value:s.flashSaleText||"",onChange:l=>n({...s,flashSaleText:l.target.value})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800 rounded-lg mt-2",children:[e.jsx("span",{className:"text-sm text-white font-bold",children:"Global Urgency Banner"}),e.jsx("input",{type:"checkbox",className:"w-5 h-5 accent-red-500",checked:s.showUrgencyBanner,onChange:l=>n({...s,showUrgencyBanner:l.target.checked})})]})]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(we,{className:"w-5 h-5 text-green-500"})," Dynamic Pricing"]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"text-xs text-slate-500 uppercase font-bold block mb-1 flex items-center gap-1",children:[e.jsx(ms,{className:"w-3 h-3"})," Billing Cycle Display"]}),e.jsx(B,{placeholder:"/year",value:s.billingCycle||"/year",onChange:l=>n({...s,billingCycle:l.target.value}),className:"font-mono text-center text-yellow-400"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-slate-800/50 rounded-xl border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-black text-blue-400 uppercase mb-3",children:"Plan B: Smart Campus"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Selling Price (₹)"}),e.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white font-mono",type:"number",value:s.smartPlanPrice,onChange:l=>n({...s,smartPlanPrice:parseInt(l.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Fake Original (₹)"}),e.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-400 font-mono",type:"number",value:s.smartPlanOriginal,onChange:l=>n({...s,smartPlanOriginal:parseInt(l.target.value)})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-red-500"}),e.jsx("label",{className:"text-xs text-slate-400",children:"Seats Left Display:"}),e.jsx("input",{className:"w-16 bg-slate-900 border border-slate-600 rounded p-1 text-white text-center font-bold",type:"number",value:s.smartPlanSeatsLeft,onChange:l=>n({...s,smartPlanSeatsLeft:parseInt(l.target.value)})})]})]}),e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-xl border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-black text-purple-400 uppercase mb-3",children:"Plan C: Institute Pro"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Selling Price (₹)"}),e.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-white font-mono",type:"number",value:s.proPlanPrice,onChange:l=>n({...s,proPlanPrice:parseInt(l.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Fake Original (₹)"}),e.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-slate-400 font-mono",type:"number",value:s.proPlanOriginal,onChange:l=>n({...s,proPlanOriginal:parseInt(l.target.value)})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4 text-red-500"}),e.jsx("label",{className:"text-xs text-slate-400",children:"Seats Left Display:"}),e.jsx("input",{className:"w-16 bg-slate-900 border border-slate-600 rounded p-1 text-white text-center font-bold",type:"number",value:s.proPlanSeatsLeft,onChange:l=>n({...s,proPlanSeatsLeft:parseInt(l.target.value)})})]})]})]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-blue-400"})," Feature Assignment Matrix"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-800 text-xs uppercase text-slate-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"Feature Name"}),e.jsx("th",{className:"p-4 text-center text-slate-300",children:"Starter (Free)"}),e.jsx("th",{className:"p-4 text-center text-blue-400",children:"Smart"}),e.jsx("th",{className:"p-4 text-center text-purple-400",children:"Pro"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-800",children:d.map(l=>{var p,j,C;return e.jsxs("tr",{className:"hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-3 text-slate-300",children:l}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",checked:(p=s.planFeatures)==null?void 0:p.starter.includes(l),onChange:()=>h("starter",l),className:"w-4 h-4 accent-slate-500"})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",checked:(j=s.planFeatures)==null?void 0:j.smart.includes(l),onChange:()=>h("smart",l),className:"w-4 h-4 accent-blue-500"})}),e.jsx("td",{className:"p-3 text-center",children:e.jsx("input",{type:"checkbox",checked:(C=s.planFeatures)==null?void 0:C.pro.includes(l),onChange:()=>h("pro",l),className:"w-4 h-4 accent-purple-500"})})]},l)})})]})})]}),e.jsx(y,{className:"bg-gradient-to-r from-yellow-900/30 to-orange-900/30 border border-yellow-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white text-lg flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-yellow-400"})," Golden Hour Strategy (Feature Tasting)"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Unlock 'Pro' features for ALL free users temporarily to increase upgrade desire."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`text-xs font-bold uppercase ${s.globalTrialMode?"text-green-400 animate-pulse":"text-slate-500"}`,children:s.globalTrialMode?"ACTIVE NOW":"INACTIVE"}),e.jsx("button",{onClick:()=>n({...s,globalTrialMode:!s.globalTrialMode}),className:`w-14 h-8 rounded-full transition-colors relative ${s.globalTrialMode?"bg-green-500":"bg-slate-700"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-6 h-6 bg-white rounded-full transition-transform ${s.globalTrialMode?"translate-x-6":"translate-x-0"}`})})]})]})})]})},tt=()=>{const[s,n]=t.useState([]),[w,f]=t.useState([]),[a,m]=t.useState(""),[d,N]=t.useState(!0),[r,h]=t.useState(null),[l,p]=t.useState(365),[j,C]=t.useState(!1),[i,g]=t.useState(!1),[S,_]=t.useState(null),[b,E]=t.useState(!1);t.useEffect(()=>{L()},[]),t.useEffect(()=>{let o=s;if(j){const T=new Date;T.setDate(T.getDate()-30),o=o.filter(k=>k.lastActive?new Date(k.lastActive)<T:!0)}if(a){const T=a.toLowerCase();o=o.filter(k=>{var $;return k.name.toLowerCase().includes(T)||k.adminEmail.toLowerCase().includes(T)||(($=k.place)==null?void 0:$.toLowerCase().includes(T))})}f(o)},[a,s,j]);const L=async()=>{N(!0);const o=await u.getAllSchools();n(o),f(o),N(!1)},I=async()=>{if(!r||!confirm(`Upgrade ${r.name} to PRO for ${l} days?`))return;(await u.manuallyUpgradeSchool(r.id,!0,l)).success?(alert("Upgrade Successful! School now has Pro access."),h(null),L()):alert("Upgrade Failed")},v=async()=>{if(!r||!confirm(`Revoke PRO access from ${r.name}?`))return;(await u.manuallyUpgradeSchool(r.id,!1,0)).success?(alert("Access Revoked."),h(null),L()):alert("Failed")},M=async()=>{if(!r)return;E(!0);const o=await u.getSchoolDeepAnalytics(r.id);_(o),E(!1),g(!0)},F=async()=>{if(!r)return;const o=`CRITICAL WARNING: This will permanently DELETE ${r.name} and ALL its data.

Type 'DELETE' to confirm.`;if(prompt(o)!=="DELETE")return;const k=await u.deleteSchool(r.id);k.success?(alert("School Deleted Successfully."),h(null),L()):alert("Delete Failed: "+k.message)},V=async()=>{if(!r||!confirm(`This will wipe all STUDENTS, CLASSES, and MARKS for ${r.name}.
The school account itself will remain.

Continue?`))return;const o=await u.resetSchoolData(r.id);o.success?(alert("Academic data wiped successfully."),L()):alert("Reset Failed: "+o.message)};return e.jsxs("div",{className:"h-full flex flex-col space-y-6 animate-fade-in-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center bg-slate-900 p-4 rounded-xl border border-slate-800 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-6 h-6 text-blue-500"}),e.jsx("h2",{className:"text-xl font-bold text-white",children:"School Manager"}),e.jsxs("span",{className:"bg-slate-800 text-slate-400 px-2 py-0.5 rounded text-xs",children:[w.length," / ",s.length]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("button",{onClick:()=>C(!j),className:`px-3 py-2 rounded-lg text-xs font-bold border transition-colors flex items-center gap-2 whitespace-nowrap ${j?"bg-red-900/20 border-red-500 text-red-400":"bg-slate-800 border-slate-700 text-slate-400 hover:text-white"}`,children:[e.jsx(xe,{className:"w-3 h-3"})," Inactive ",j&&"(>30d)"]}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(Q,{className:"absolute left-3 top-2.5 w-4 h-4 text-slate-500"}),e.jsx("input",{type:"text",placeholder:"Search schools...",value:a,onChange:o=>m(o.target.value),className:"w-full bg-slate-950 border border-slate-700 rounded-lg pl-9 pr-4 py-2 text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-600"})]})]})]}),e.jsx(y,{className:"flex-1 p-0 bg-slate-900 border-slate-800 overflow-hidden",children:e.jsx("div",{className:"overflow-y-auto h-[600px] custom-scrollbar",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-slate-950 text-slate-400 text-xs uppercase sticky top-0 z-10 border-b border-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4",children:"School Name"}),e.jsx("th",{className:"p-4",children:"Admin Email"}),e.jsx("th",{className:"p-4 text-center",children:"Status"}),e.jsx("th",{className:"p-4 text-center",children:"Students"}),e.jsx("th",{className:"p-4 text-center",children:"Expiry"}),e.jsx("th",{className:"p-4 text-center",children:"Last Active"}),e.jsx("th",{className:"p-4 text-center",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-800",children:[w.map(o=>{const T=!o.lastActive||new Date().getTime()-new Date(o.lastActive).getTime()>2592e6;return e.jsxs("tr",{className:"hover:bg-slate-800/50 transition-colors",children:[e.jsxs("td",{className:"p-4",children:[e.jsx("span",{className:"font-bold text-white block",children:o.name}),e.jsx("span",{className:"text-[10px] text-slate-500",children:o.place})]}),e.jsx("td",{className:"p-4 text-slate-300 font-mono text-xs",children:o.adminEmail}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`px-2 py-1 rounded text-[10px] font-bold ${o.isPro?"bg-green-500/20 text-green-400":"bg-slate-800 text-slate-400"}`,children:o.isPro?"PRO":"FREE"})}),e.jsx("td",{className:"p-4 text-center text-white font-bold",children:o.studentCount}),e.jsx("td",{className:"p-4 text-center font-mono text-xs text-slate-400",children:o.expiryDate?new Date(o.expiryDate).toLocaleDateString():"-"}),e.jsx("td",{className:`p-4 text-center font-mono text-xs ${T?"text-red-400 font-bold":"text-green-400"}`,children:o.lastActive?new Date(o.lastActive).toLocaleDateString():"Never"}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("button",{onClick:()=>h(o),className:"p-2 hover:bg-slate-700 rounded-full transition-colors text-slate-400 hover:text-white",children:e.jsx(Bs,{className:"w-4 h-4"})})})]},o.id)}),w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-slate-500",children:"No schools found matching your criteria."})})]})]})})}),r&&!i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:e.jsxs(y,{className:"w-full max-w-md border-t-4 border-t-blue-500 bg-slate-900 border-slate-800 shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:r.name}),e.jsx("p",{className:"text-sm text-slate-400",children:r.isPro?"Currently Pro Plan":"Currently Free Plan"}),e.jsxs("p",{className:"text-[10px] text-slate-500 mt-1 flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"})," Last Active: ",r.lastActive?new Date(r.lastActive).toDateString():"Never"]})]}),e.jsx("button",{onClick:()=>h(null),className:"text-slate-500 hover:text-white",children:"✕"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:M,className:"w-full py-3 bg-slate-800 hover:bg-slate-700 text-white rounded-xl font-bold flex items-center justify-center gap-2 border border-slate-700",children:b?"Scanning...":e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 text-blue-400"})," View Deep Intelligence"]})}),e.jsx("div",{className:"h-px bg-slate-800 my-2"}),r.isPro?e.jsxs("div",{className:"bg-red-900/20 p-4 rounded-xl border border-red-900/50",children:[e.jsxs("h4",{className:"text-red-400 font-bold mb-2 flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"})," Revoke Access"]}),e.jsx("button",{onClick:v,className:"w-full bg-red-600 hover:bg-red-700 text-white font-bold rounded py-2 text-xs",children:"Revoke Pro Status"})]}):e.jsxs("div",{className:"bg-green-900/20 p-4 rounded-xl border border-green-900/50",children:[e.jsxs("h4",{className:"text-green-400 font-bold mb-2 flex items-center gap-2",children:[e.jsx(hs,{className:"w-4 h-4"})," Grant Special Upgrade"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",value:l,onChange:o=>p(parseInt(o.target.value)),className:"w-20 bg-slate-950 border border-slate-700 rounded p-2 text-white text-sm text-center"}),e.jsxs("button",{onClick:I,className:"flex-1 bg-green-600 hover:bg-green-700 text-white font-bold rounded py-2 text-xs",children:["Grant ",l," Days"]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-slate-800",children:[e.jsxs("p",{className:"text-[10px] font-bold text-red-500 uppercase mb-2 flex items-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Danger Zone"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:V,className:"flex-1 py-2 bg-slate-800 border border-red-900/30 text-red-400 hover:bg-red-900/20 rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[e.jsx(Ps,{className:"w-3 h-3"})," Wipe Data"]}),e.jsxs("button",{onClick:F,className:"flex-1 py-2 bg-red-900/20 hover:bg-red-900/40 text-red-500 border border-red-900/50 rounded-lg text-xs font-bold flex items-center justify-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"})," Delete School"]})]})]})]})]})}),i&&S&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 animate-fade-in-up",children:e.jsxs(y,{className:"w-full max-w-4xl h-[90vh] bg-slate-950 border border-slate-800 flex flex-col p-0 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-slate-800 flex justify-between items-center bg-slate-900",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-slate-800 rounded-lg flex items-center justify-center border border-slate-700",children:e.jsx($e,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:r==null?void 0:r.name}),e.jsx("p",{className:"text-xs text-slate-400",children:"Data Intelligence Report"})]})]}),e.jsx("button",{onClick:()=>g(!1),className:"p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-xl border ${S.health.riskLevel==="HIGH"?"bg-red-900/20 border-red-900/50":S.health.riskLevel==="MEDIUM"?"bg-orange-900/20 border-orange-900/50":"bg-green-900/20 border-green-900/50"}`,children:[e.jsx("p",{className:"text-xs font-bold uppercase opacity-70 mb-1 text-white",children:"Churn Risk"}),e.jsx("h3",{className:`text-2xl font-black ${S.health.riskLevel==="HIGH"?"text-red-500":S.health.riskLevel==="MEDIUM"?"text-orange-500":"text-green-500"}`,children:S.health.riskLevel})]}),e.jsxs("div",{className:"p-4 bg-slate-900 rounded-xl border border-slate-800",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-1",children:"Database Footprint"}),e.jsxs("h3",{className:"text-2xl font-black text-white",children:[S.storage.usedMB," MB"]})]}),e.jsxs("div",{className:"p-4 bg-slate-900 rounded-xl border border-slate-800",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase mb-1",children:"User Base"}),e.jsx("h3",{className:"text-2xl font-black text-white",children:S.counts.students})]})]})})]})})]})},at=()=>{var N,r,h;const[s,n]=t.useState(null),[w,f]=t.useState(!0);t.useEffect(()=>{a()},[]);const a=async()=>{const l=await u.getAttributionStats();n(l),f(!1)};if(w)return e.jsx("div",{children:"Loading Growth Metrics..."});const m=(s==null?void 0:s.sources)||[],d=m.reduce((l,p)=>l+p.count,0);return e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(q,{className:"w-6 h-6 text-yellow-400 fill-yellow-400"})," Viral Loop Analytics"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Total Referrals"}),e.jsx("h3",{className:"text-4xl font-black text-white mt-1",children:d}),e.jsxs("p",{className:"text-xs text-green-400 mt-2 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3"})," +12% this week"]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Top Source"}),e.jsx("h3",{className:"text-2xl font-black text-white mt-1",children:((N=m[0])==null?void 0:N.source)||"None"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-2",children:[((r=m[0])==null?void 0:r.count)||0," Signups"]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:"Attributed Revenue"}),e.jsxs("h3",{className:"text-4xl font-black text-white mt-1",children:["₹",s==null?void 0:s.revenue.toLocaleString()]}),e.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"From viral channels"})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsx("h3",{className:"font-bold text-white mb-6",children:"Acquisition Channels"}),e.jsxs("div",{className:"space-y-4",children:[m.map((l,p)=>{const j=l.count/d*100;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1 text-slate-300",children:[e.jsx("span",{className:"font-bold",children:l.source.replace("_"," ")}),e.jsxs("span",{children:[l.count," (",j.toFixed(1),"%)"]})]}),e.jsx("div",{className:"w-full bg-slate-800 h-2 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${p===0?"bg-blue-500":p===1?"bg-purple-500":"bg-slate-600"}`,style:{width:`${j}%`}})})]},p)}),m.length===0&&e.jsx("p",{className:"text-slate-500 text-sm text-center",children:"No referral data yet."})]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsx("h3",{className:"font-bold text-white mb-6",children:"Top Viral Schools"}),e.jsxs("div",{className:"space-y-4",children:[(h=s==null?void 0:s.topReferrers)==null?void 0:h.map((l,p)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-xl border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-700 rounded-full flex items-center justify-center font-bold text-slate-400 text-xs",children:p+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-white",children:l.name}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:["ID: ",l.id.substring(0,8),"..."]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-green-400",children:l.count}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"Refers"})]})]},p)),(!(s!=null&&s.topReferrers)||s.topReferrers.length===0)&&e.jsx("p",{className:"text-slate-500 text-sm text-center",children:"No top referrers."})]})]})]})]})},lt=()=>{const[s,n]=t.useState([]),[w,f]=t.useState(!0),[a,m]=t.useState([]),[d,N]=t.useState(""),[r,h]=t.useState(""),[l,p]=t.useState(!1),[j,C]=t.useState(null),[i,g]=t.useState([]),[S,_]=t.useState(""),[b,E]=t.useState("50"),[L,I]=t.useState("18"),[v,M]=t.useState([]),[F,V]=t.useState(null);t.useEffect(()=>{o()},[]);const o=async()=>{f(!0);const[x,A]=await Promise.all([u.getPendingQuestions(),u.getSyllabi()]);n(x),m(A),f(!1)},T=async(x,A)=>{await u.moderateQuestion(x,A),o()},k=async()=>{if(!d)return alert("Name required");const A=r?r.split(",").map(O=>O.trim()).filter(O=>O):["LKG","UKG","1","2","3","4","5","6","7","8","9","10","+1","+2"];p(!0);const R=await u.createCustomSyllabus(d,A,!0);p(!1),R.success?(alert("Syllabus Template Created!"),N(""),h(""),o()):alert("Failed: "+R.message)},$=async x=>{confirm("Delete this Global Syllabus?")&&(await u.deleteCustomSyllabus(x),o())},H=x=>{const A={};return Object.entries(x.subjects).forEach(([R,O])=>{O.forEach(G=>{const Y=G.name.trim();A[Y]||(A[Y]={id:Y,name:G.name,max:G.maxMarks,pass:G.passMarks,classes:[]}),A[Y].classes.includes(R)||A[Y].classes.push(R)})}),Object.values(A)},W=(x,A)=>{const R={};return A.forEach(O=>R[O]=[]),x.forEach(O=>{O.classes.forEach(G=>{R[G]||(R[G]=[]),R[G].push({name:O.name,maxMarks:O.max,passMarks:O.pass})})}),R},se=x=>{C(x),g(H(x)),z()},z=()=>{_(""),E("50"),I("18"),M([]),V(null)},te=x=>{M(A=>A.includes(x)?A.filter(R=>R!==x):[...A,x])},ae=()=>{j&&(v.length===j.classRanges.length?M([]):M([...j.classRanges]))},le=()=>{if(!S)return alert("Subject Name Required");if(v.length===0)return alert("Please select at least one class");const x={id:F||S.trim(),name:S,max:parseInt(b)||50,pass:parseInt(L)||18,classes:v};g(A=>F?A.map(R=>R.id===F?x:R):A.some(R=>R.name.toLowerCase()===S.toLowerCase())?(alert("Subject already exists. Edit it from the list."),A):[...A,x]),z()},re=x=>{V(x.id),_(x.name),E(x.max.toString()),I(x.pass.toString()),M(x.classes)},ne=x=>{confirm("Remove this subject from ALL classes?")&&g(A=>A.filter(R=>R.id!==x))},ce=async()=>{if(!j)return;const x=W(i,j.classRanges),A=await u.updateSyllabusStructure(j.id,x);if(A.success){alert("Syllabus Updated Successfully!");const R={...j,subjects:x};m(O=>O.map(G=>G.id===R.id?R:G)),C(null)}else alert("Failed to save: "+A.message)};return w?e.jsx("div",{children:"Loading Content Manager..."}):e.jsxs("div",{className:"space-y-6 animate-fade-in-up",children:[!j&&e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-green-500"})," Create New Standard"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Syllabus Name"}),e.jsx(B,{placeholder:"e.g. Kerala State 2025",value:d,onChange:x=>N(x.target.value),className:"bg-slate-950 border-slate-700 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase",children:"Class Levels (Comma Separated)"}),e.jsx(B,{placeholder:"Default: LKG to +2 (Leave empty for default)",value:r,onChange:x=>h(x.target.value),className:"bg-slate-950 border-slate-700 text-white"})]}),e.jsx(U,{onClick:k,disabled:l,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:l?"Creating...":"Create Template"})]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800 flex flex-col h-[300px]",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(ve,{className:"w-5 h-5 text-blue-500"})," Existing Standards"]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2",children:a.map(x=>e.jsxs("div",{className:"p-3 bg-slate-800 rounded-lg flex justify-between items-center group border border-transparent hover:border-slate-600",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-white text-sm",children:x.name}),e.jsxs("p",{className:"text-[10px] text-slate-500",children:[x.classRanges.length," Classes Defined"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>se(x),className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-xs font-bold flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"})," Manage"]}),e.jsx("button",{onClick:()=>$(x.id),className:"p-1.5 text-slate-500 hover:text-red-500 rounded",children:e.jsx(he,{className:"w-4 h-4"})})]})]},x.id))})]})]}),j&&e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:j.name}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Define subjects once, apply to many classes."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(null),className:"px-4 py-2 text-sm font-bold text-slate-400 hover:text-white",children:"Cancel"}),e.jsxs(U,{onClick:ce,className:"bg-green-600 hover:bg-green-700 text-white shadow-lg",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"})," Save Syllabus"]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-12 gap-6",children:[e.jsx("div",{className:"md:col-span-5 space-y-4",children:e.jsxs(y,{className:"bg-slate-900 border-l-4 border-l-blue-500 border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[F?e.jsx(ie,{className:"w-4 h-4 text-yellow-500"}):e.jsx(Ce,{className:"w-4 h-4 text-blue-500"}),F?"Edit Subject":"Add New Subject"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold block mb-1",children:"Subject Name"}),e.jsx(B,{className:"bg-slate-950 text-white border-slate-700",placeholder:"e.g. Mathematics",value:S,onChange:x=>_(x.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold block mb-1",children:"Max Marks"}),e.jsx(B,{type:"number",className:"bg-slate-950 text-white border-slate-700",value:b,onChange:x=>E(x.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold block mb-1",children:"Pass Marks"}),e.jsx(B,{type:"number",className:"bg-slate-950 text-white border-slate-700",value:L,onChange:x=>I(x.target.value)})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold",children:"Applies To Classes:"}),e.jsx("button",{onClick:ae,className:"text-[10px] text-blue-400 hover:text-blue-300 font-bold",children:v.length===j.classRanges.length?"Deselect All":"Select All"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:j.classRanges.map(x=>e.jsx("button",{onClick:()=>te(x),className:`px-2 py-1.5 rounded text-xs font-bold transition-all border ${v.includes(x)?"bg-blue-600 text-white border-blue-500":"bg-slate-950 text-slate-400 border-slate-700 hover:border-slate-500"}`,children:x},x))})]}),e.jsxs("div",{className:"pt-2 flex gap-2",children:[F&&e.jsx(U,{variant:"secondary",onClick:z,className:"flex-1 bg-slate-800 text-slate-300",children:"Cancel"}),e.jsx(U,{onClick:le,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:F?"Update Subject":"Add to List"})]})]})]})}),e.jsx("div",{className:"md:col-span-7",children:e.jsxs(y,{className:"bg-slate-900 border-slate-800 h-full flex flex-col min-h-[400px]",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(As,{className:"w-5 h-5 text-purple-500"})," Configured Subjects (",i.length,")"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-2 pr-1",children:[i.length===0&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-600 border-2 border-dashed border-slate-800 rounded-xl p-8",children:[e.jsx(ve,{className:"w-12 h-12 mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No subjects added yet."}),e.jsx("p",{className:"text-xs",children:"Use the form on the left to add one."})]}),i.map(x=>e.jsxs("div",{className:"bg-slate-800 p-3 rounded-xl flex items-center justify-between group border border-transparent hover:border-slate-600",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-white text-sm",children:x.name}),e.jsxs("span",{className:"text-[10px] bg-slate-950 text-slate-400 px-1.5 py-0.5 rounded border border-slate-700",children:[x.max,"/",x.pass]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1.5",children:[x.classes.length===j.classRanges.length?e.jsx("span",{className:"text-[9px] font-bold text-green-400 bg-green-900/20 px-1.5 rounded",children:"All Classes"}):x.classes.map(A=>e.jsx("span",{className:"text-[9px] text-slate-300 bg-slate-700 px-1.5 rounded",children:A},A)),x.classes.length===0&&e.jsx("span",{className:"text-[9px] text-red-400",children:"No classes selected"})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>re(x),className:"p-2 bg-blue-900/30 text-blue-400 hover:bg-blue-900/50 rounded-lg",children:e.jsx(ie,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>ne(x.id),className:"p-2 bg-red-900/30 text-red-400 hover:bg-red-900/50 rounded-lg",children:e.jsx(he,{className:"w-3 h-3"})})]})]},x.id))]})]})})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-slate-800 mt-8",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(us,{className:"w-5 h-5 text-purple-400"})," Content Moderation"]}),e.jsx("button",{onClick:o,className:"p-2 bg-slate-800 rounded-full hover:bg-slate-700",children:e.jsx(X,{className:"w-4 h-4 text-white"})})]}),e.jsx(y,{className:"bg-slate-900 border-slate-800 p-0 overflow-hidden",children:e.jsxs("div",{className:"overflow-y-auto max-h-[300px] custom-scrollbar",children:[s.length===0&&e.jsx("p",{className:"text-center text-slate-500 py-10",children:"No pending contributions."}),s.map(x=>e.jsx("div",{className:"p-4 border-b border-slate-800 hover:bg-slate-800/30 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 mb-1",children:[e.jsx("span",{className:"text-[10px] bg-blue-900/30 text-blue-400 px-2 py-0.5 rounded border border-blue-900/50",children:x.subject}),e.jsx("span",{className:"text-[10px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded",children:x.topic})]}),e.jsx("p",{className:"font-bold text-white text-sm mb-2",children:x.text}),e.jsxs("p",{className:"text-[10px] text-slate-600 flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"})," Contributed by: ",x.contributedBy]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(x.id,"APPROVE"),className:"p-2 bg-green-900/20 text-green-500 hover:bg-green-900/40 rounded-lg",children:e.jsx(pe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>T(x.id,"REJECT"),className:"p-2 bg-red-900/20 text-red-500 hover:bg-red-900/40 rounded-lg",children:e.jsx(bs,{className:"w-5 h-5"})})]})]})},x.id))]})})]})},rt=({school:s})=>e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 animate-fade-in-up",children:[e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-500"})," Basic Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"School Name"}),e.jsx("span",{className:"text-white font-bold",children:s.name})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsxs("span",{className:"text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(ps,{className:"w-3 h-3"})," Location"]}),e.jsx("span",{className:"text-white",children:s.place||"N/A"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsxs("span",{className:"text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(gs,{className:"w-3 h-3"})," Phone"]}),e.jsx("span",{className:"text-white",children:s.phone||"N/A"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsxs("span",{className:"text-slate-500 text-sm flex items-center gap-2",children:[e.jsx(fs,{className:"w-3 h-3"})," Admin Email"]}),e.jsx("span",{className:"text-white",children:s.admin_email})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"Created At"}),e.jsx("span",{className:"text-white font-mono text-xs",children:new Date(s.created_at).toLocaleString()})]})]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-purple-500"})," Web Configuration"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"Slug / URL"}),e.jsx("span",{className:"text-white font-mono",children:s.slug||"-"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"Theme Color"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full bg-${s.theme_color||"blue"}-500`}),e.jsx("span",{className:"text-white capitalize",children:s.theme_color||"Default"})]})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"Public Admission"}),e.jsx("span",{className:`font-bold ${s.allow_public_admission?"text-green-500":"text-red-500"}`,children:s.allow_public_admission?"ENABLED":"DISABLED"})]}),e.jsxs("div",{className:"flex justify-between border-b border-slate-800 pb-2",children:[e.jsx("span",{className:"text-slate-500 text-sm",children:"Plan Expiry"}),e.jsx("span",{className:`font-bold ${new Date(s.expiry_date)>new Date?"text-green-500":"text-red-500"}`,children:s.expiry_date?new Date(s.expiry_date).toLocaleDateString():"N/A"})]})]})]})]}),nt=({school:s})=>{const[n,w]=t.useState(!1),f=a=>{navigator.clipboard.writeText(a),alert("Copied to clipboard!")};return e.jsx("div",{className:"animate-fade-in-up space-y-6",children:e.jsxs(y,{className:"bg-red-900/10 border-red-900/50 border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-red-400 font-bold flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"})," Sensitive Configuration"]}),e.jsx("button",{onClick:()=>w(!n),className:"text-xs bg-slate-800 hover:bg-slate-700 text-white px-3 py-1.5 rounded flex items-center gap-2 transition-colors",children:n?e.jsxs(e.Fragment,{children:[e.jsx(Ns,{className:"w-3 h-3"})," Hide Secrets"]}):e.jsxs(e.Fragment,{children:[e.jsx(js,{className:"w-3 h-3"})," Reveal Secrets"]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Master Recovery Key"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 bg-slate-900 p-2 rounded text-sm font-mono text-yellow-500 tracking-widest",children:n?s.recovery_code||"NOT_SET":"••••-••••-••••-••••"}),e.jsx("button",{onClick:()=>f(s.recovery_code),className:"p-2 bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white rounded transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase flex items-center gap-2",children:[e.jsx(vs,{className:"w-3 h-3"})," Principal Access"]}),s.has_principal_login?e.jsx("span",{className:"text-[10px] text-green-500 font-bold",children:"ACTIVE"}):e.jsx("span",{className:"text-[10px] text-red-500 font-bold",children:"INACTIVE"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-600 mb-1",children:"Email"}),e.jsx("div",{className:"bg-slate-900 p-2 rounded text-sm text-slate-300 font-mono",children:s.principal_email||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-slate-600 mb-1",children:"Password"}),e.jsxs("div",{className:"bg-slate-900 p-2 rounded text-sm text-slate-300 font-mono flex justify-between",children:[e.jsx("span",{children:n?s.principal_password||"N/A":"••••••••"}),n&&e.jsx(Ee,{onClick:()=>f(s.principal_password),className:"w-4 h-4 cursor-pointer text-slate-500 hover:text-white"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Admission Token (System Internal)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("code",{className:"flex-1 bg-slate-900 p-2 rounded text-sm font-mono text-purple-400",children:n?s.admission_token||"NULL":"••••••••••••••••"})})]})]})]})})},We=({school:s,onRefresh:n})=>{const[w,f]=t.useState(""),[a,m]=t.useState(""),[d,N]=t.useState(!1),[r,h]=t.useState("GRANT"),l=async()=>{const p=parseInt(w);if(isNaN(p)||p<=0)return alert("Invalid amount");if(r==="DEDUCT"&&!a)return alert("Please provide a reason for deduction.");const j=r==="GRANT"?`Grant ${p} credits to ${s.name}?`:`DEDUCT ${p} credits from ${s.name}?
Reason: ${a}`;if(!confirm(j))return;N(!0);let C;r==="GRANT"?C=await u.superAdminGrantCredits(s.id,p):C=await u.superAdminDeductCredits(s.id,p,a),N(!1),C.success?(alert(`Success! New Balance: ${C.newBalance}`),f(""),m(""),n()):alert("Failed: "+C.message)};return e.jsxs("div",{className:"animate-fade-in-up space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(y,{className:"bg-gradient-to-br from-yellow-900/40 to-orange-900/40 border-yellow-500/30 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-yellow-500 font-bold mb-1 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 fill-current"})," Wallet Balance"]}),e.jsx("p",{className:"text-xs text-yellow-200/60",children:"Available for AI & SMS"})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("span",{className:"text-5xl font-black text-white",children:s.wallet_balance||0}),e.jsx("span",{className:"text-xl text-yellow-500 font-bold ml-1",children:"CR"})]})]}),e.jsxs(y,{className:`border-t-4 ${r==="GRANT"?"border-t-green-500 bg-slate-900":"border-t-red-500 bg-red-900/10"}`,children:[e.jsxs("div",{className:"flex bg-slate-800 p-1 rounded-lg mb-4",children:[e.jsx("button",{onClick:()=>h("GRANT"),className:`flex-1 py-1.5 text-xs font-bold rounded transition-all ${r==="GRANT"?"bg-green-600 text-white":"text-slate-400 hover:text-white"}`,children:"Grant Credits"}),e.jsx("button",{onClick:()=>h("DEDUCT"),className:`flex-1 py-1.5 text-xs font-bold rounded transition-all ${r==="DEDUCT"?"bg-red-600 text-white":"text-slate-400 hover:text-white"}`,children:"Deduct / Penalty"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Amount"}),e.jsx(B,{type:"number",placeholder:"e.g. 500",value:w,onChange:p=>f(p.target.value),className:"bg-slate-950 border-slate-700 text-white font-mono font-bold text-lg"})]}),r==="DEDUCT"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase block mb-1",children:"Reason (Required)"}),e.jsx(B,{placeholder:"e.g. Refund reversal / Fraud adjustment",value:a,onChange:p=>m(p.target.value),className:"bg-slate-950 border-slate-700 text-white text-sm"})]}),e.jsx(U,{onClick:l,disabled:d,className:`w-full text-white shadow-lg ${r==="GRANT"?"bg-green-600 hover:bg-green-700 shadow-green-900/20":"bg-red-600 hover:bg-red-700 shadow-red-900/20"}`,children:d?"Processing...":r==="GRANT"?e.jsxs(e.Fragment,{children:[e.jsx(ws,{className:"w-4 h-4 mr-2"})," Add Credits"]}):e.jsxs(e.Fragment,{children:[e.jsx(Gs,{className:"w-4 h-4 mr-2"})," Deduct Credits"]})}),r==="DEDUCT"&&e.jsxs("p",{className:"text-[10px] text-red-400 text-center flex items-center justify-center gap-1",children:[e.jsx(be,{className:"w-3 h-3"})," Caution: This will reduce the school's balance."]})]})]})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("h3",{className:"text-white font-bold mb-4 flex items-center gap-2",children:[e.jsx(_s,{className:"w-5 h-5 text-blue-500"})," Recent Activity"]}),e.jsx("div",{className:"bg-slate-950 rounded-xl p-4 text-center text-slate-500 text-sm italic",children:"Use 'Infrastructure > SQL Migrator' to view raw transaction logs if needed."})]})]})},ct=({school:s})=>{var n,w;return e.jsxs("div",{className:"animate-fade-in-up",children:[e.jsxs("h3",{className:"text-white font-bold mb-6 text-xl flex items-center gap-2",children:[e.jsx(it,{className:"w-6 h-6 text-indigo-500"})," Academic Database"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(y,{className:"bg-slate-900 border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-900/30 rounded-2xl flex items-center justify-center text-blue-400",children:e.jsx(ue,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 font-bold uppercase text-xs",children:"Total Students"}),e.jsx("h2",{className:"text-4xl font-black text-white",children:((n=s.stats)==null?void 0:n.students)||0})]})]})}),e.jsx(y,{className:"bg-slate-900 border-slate-800",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-900/30 rounded-2xl flex items-center justify-center text-purple-400",children:e.jsx(ee,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 font-bold uppercase text-xs",children:"Active Classes"}),e.jsx("h2",{className:"text-4xl font-black text-white",children:((w=s.stats)==null?void 0:w.classes)||0})]})]})})]}),e.jsxs("div",{className:"mt-8 bg-slate-900 border border-slate-800 rounded-xl p-8 text-center",children:[e.jsx(ys,{className:"w-16 h-16 text-slate-700 mx-auto mb-4"}),e.jsx("h3",{className:"text-white font-bold text-lg",children:"Detailed Academic View"}),e.jsx("p",{className:"text-slate-500 text-sm max-w-sm mx-auto mt-2",children:"To view individual student marks and class-level details, please login as School Admin (Ghost Login) or use the Support Desk tools."})]})]})},it=({className:s})=>e.jsxs("svg",{className:s,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M3 5V19C3 20.1046 7.02944 21 12 21C16.9706 21 21 20.1046 21 19V5M3 5C3 6.10457 7.02944 7 12 7C16.9706 7 21 6.10457 21 5M3 5C3 3.89543 7.02944 3 12 3C16.9706 3 21 3.89543 21 5"}),e.jsx("path",{d:"M3 12C3 13.1046 7.02944 14 12 14C16.9706 14 21 13.1046 21 12"})]}),ot=()=>{const[s,n]=t.useState(""),[w,f]=t.useState([]),[a,m]=t.useState(!1),[d,N]=t.useState(null),[r,h]=t.useState(!1),[l,p]=t.useState("PROFILE");t.useEffect(()=>{const i=setTimeout(async()=>{if(s.length>2){m(!0);const S=(await u.getAllSchools()).filter(_=>_.name.toLowerCase().includes(s.toLowerCase())||_.adminEmail.toLowerCase().includes(s.toLowerCase())||_.id.includes(s));f(S),m(!1)}else f([])},500);return()=>clearTimeout(i)},[s]);const j=async i=>{h(!0);const g=await u.getSchoolFullDetails(i);N(g),h(!1),n(""),f([]),p("PROFILE")},C=async()=>{d&&j(d.id)};return d?e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 bg-slate-900 p-4 rounded-xl border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>N(null),className:"p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition-colors",children:e.jsx(de,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[d.name,d.is_pro&&e.jsx("span",{className:"text-[10px] bg-green-600 text-white px-2 py-0.5 rounded",children:"PRO"})]}),e.jsxs("p",{className:"text-xs font-mono text-slate-500",children:["ID: ",d.id]})]})]}),e.jsx("div",{className:"flex gap-2",children:["PROFILE","SECRETS","WALLET","DATA"].map(i=>e.jsxs("button",{onClick:()=>p(i),className:`px-4 py-2 rounded-lg text-xs font-bold transition-all flex items-center gap-2 ${l===i?"bg-blue-600 text-white shadow-lg":"bg-slate-800 text-slate-400 hover:text-white"}`,children:[i==="PROFILE"&&e.jsx(ee,{className:"w-4 h-4"}),i==="SECRETS"&&e.jsx(Ue,{className:"w-4 h-4"}),i==="WALLET"&&e.jsx(Me,{className:"w-4 h-4"}),i==="DATA"&&e.jsx(K,{className:"w-4 h-4"}),i]},i))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[l==="PROFILE"&&e.jsx(rt,{school:d}),l==="SECRETS"&&e.jsx(nt,{school:d}),l==="WALLET"&&e.jsx(We,{school:d,onRefresh:C}),l==="DATA"&&e.jsx(ct,{school:d})]})]}):e.jsxs("div",{className:"max-w-2xl mx-auto pt-10 animate-fade-in-up",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-20 h-20 bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4 border border-blue-500/30",children:e.jsx(Q,{className:"w-10 h-10 text-blue-400"})}),e.jsx("h2",{className:"text-3xl font-black text-white",children:"School Inspector"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Access 100% data, secrets, and wallet control for any campus."})]}),e.jsxs(y,{className:"bg-slate-900 border-slate-800 p-6 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"absolute left-4 top-3.5 w-5 h-5 text-slate-500"}),e.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded-xl pl-12 pr-4 py-3 text-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all",placeholder:"Search by Name, Email, or ID...",value:s,onChange:i=>n(i.target.value),autoFocus:!0}),a&&e.jsx(Te,{className:"absolute right-4 top-3.5 w-5 h-5 text-blue-500 animate-spin"})]}),w.length>0&&e.jsx("div",{className:"mt-4 space-y-2 max-h-60 overflow-y-auto custom-scrollbar",children:w.map(i=>e.jsxs("div",{onClick:()=>j(i.id),className:"p-3 bg-slate-800 hover:bg-slate-700 rounded-lg cursor-pointer flex justify-between items-center transition-colors border border-transparent hover:border-slate-600",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white text-sm",children:i.name}),e.jsx("p",{className:"text-xs text-slate-400",children:i.adminEmail})]}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded ${i.isPro?"bg-green-900/30 text-green-400":"bg-slate-900 text-slate-500"}`,children:i.isPro?"PRO":"FREE"})]},i.id))}),s.length>2&&!a&&w.length===0&&e.jsx("p",{className:"text-center text-slate-500 mt-4 text-sm",children:"No schools found."})]}),r&&e.jsxs("div",{className:"text-center mt-8",children:[e.jsx(Te,{className:"w-8 h-8 text-blue-500 animate-spin mx-auto mb-2"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Decrypting Secure Data..."})]})]})},dt=()=>{const[s,n]=t.useState([]),[w,f]=t.useState(!1),[a,m]=t.useState(null);t.useEffect(()=>{d()},[]);const d=async()=>{f(!0),m(null);const h=await u.getFraudRiskReport();n(h),f(!1)},N=async h=>{const l=await u.getSchoolFullDetails(h);m(l)},r=async h=>{if(!confirm("Are you sure you want to delete/ban this school? This is destructive."))return;const l=await u.deleteSchool(h);l.success?(alert("School Banned/Deleted."),d()):alert("Failed: "+l.message)};return e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-6 h-6 text-red-500"})," Fraud & Risk Scanner"]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Detect suspicious wallet activity and fake accounts."})]}),e.jsxs(U,{onClick:d,disabled:w,className:"bg-slate-800 text-white hover:bg-slate-700 flex items-center gap-2",children:[e.jsx(X,{className:`w-4 h-4 ${w?"animate-spin":""}`})," Run Scan"]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"md:col-span-1 bg-slate-900 border border-slate-800 rounded-xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-slate-800 bg-red-900/10",children:e.jsxs("h3",{className:"font-bold text-red-400 text-sm flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"})," High Risk Accounts (",s.length,")"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:[w&&e.jsx("p",{className:"text-center text-slate-500 py-10",children:"Scanning Database..."}),!w&&s.length===0&&e.jsxs("div",{className:"text-center py-10 text-green-500",children:[e.jsx(me,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No threats detected."})]}),s.map(h=>e.jsxs("div",{onClick:()=>N(h.id),className:`p-3 rounded-lg border cursor-pointer transition-all ${(a==null?void 0:a.id)===h.id?"bg-slate-800 border-red-500":"bg-slate-900 border-slate-800 hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h4",{className:"font-bold text-white text-sm truncate w-2/3",children:h.name}),e.jsxs("span",{className:"text-xs font-mono text-red-400 font-bold",children:[h.riskScore,"% Risk"]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:h.flags.map((l,p)=>e.jsx("span",{className:"text-[9px] bg-red-500/20 text-red-300 px-1.5 py-0.5 rounded",children:l},p))}),e.jsxs("p",{className:"text-[10px] text-slate-500 font-mono",children:["Bal: ",h.balance," CR"]})]},h.id))]})]}),e.jsx("div",{className:"md:col-span-2",children:a?e.jsx("div",{className:"space-y-6",children:e.jsxs(y,{className:"bg-slate-900 border-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:a.name}),e.jsx("p",{className:"text-sm text-slate-400",children:a.admin_email}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["ID: ",a.id]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("button",{onClick:()=>r(a.id),className:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-lg flex items-center gap-2",children:[e.jsx(ks,{className:"w-4 h-4"})," Ban / Delete"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs text-slate-300 mb-6",children:[e.jsxs("div",{className:"p-3 bg-slate-950 rounded border border-slate-800",children:[e.jsx("span",{className:"text-slate-500 block mb-1",children:"Phone"}),a.phone]}),e.jsxs("div",{className:"p-3 bg-slate-950 rounded border border-slate-800",children:[e.jsx("span",{className:"text-slate-500 block mb-1",children:"Place"}),a.place]})]}),e.jsx("h4",{className:"text-sm font-bold text-white mb-3",children:"Corrective Action (Wallet)"}),e.jsx(We,{school:a,onRefresh:()=>N(a.id)})]})}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-slate-600 border-2 border-dashed border-slate-800 rounded-xl bg-slate-900/50",children:[e.jsx(Q,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{children:"Select a suspicious account to investigate."})]})})]})]})},xt=()=>{const[s,n]=t.useState([]),[w,f]=t.useState(!0),[a,m]=t.useState(null),[d,N]=t.useState(null),[r,h]=t.useState(!1);t.useEffect(()=>{l()},[]);const l=async()=>{f(!0);const i=await u.getPendingPaymentProofs();i.success?n(i.data):(console.error("Finance Load Error:",i.message),alert("Failed to load: "+i.message)),f(!1)},p=async()=>{h(!0);const i=await u.runDatabaseMigration(Xe);h(!1),i.success?(alert("Database Integrity Check Complete."),l()):alert("Fix Failed: "+i.message)},j=async(i,g)=>{if(!(!g&&!confirm("Approve payment? This will update balance/fees."))){N(i);try{const S=await u.approvePaymentProof(i);S.success?n(_=>_.filter(b=>b.id!==i)):alert("Approval Error: "+(S.message||"Unknown error"))}catch(S){alert("Network/Server Error: "+S.message)}finally{N(null)}}},C=async(i,g)=>{if(confirm(g?"⚠️ Rejecting this will REVERSE the credits already given to the partner. Continue?":"Reject this payment proof?")){N(i);try{const _=await u.rejectPaymentProof(i);_.success?n(b=>b.filter(E=>E.id!==i)):alert("Reject Error: "+(_.message||"Unknown"))}catch(_){alert("Error: "+_.message)}finally{N(null)}}};return e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:"Finance & Approvals"}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Validate GPay Transactions (Schools & Partners)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:p,disabled:r,className:"bg-slate-800 text-slate-400 hover:text-white px-3 py-2 rounded-lg text-xs font-bold flex items-center gap-2",title:"Run DB Repair if items missing",children:[r?e.jsx(X,{className:"w-3 h-3 animate-spin"}):e.jsx(K,{className:"w-3 h-3"}),"DB Repair"]}),e.jsx(U,{onClick:l,className:"bg-slate-800 text-white hover:bg-slate-700",children:e.jsx(X,{className:`w-4 h-4 ${w?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[s.length===0&&!w&&e.jsxs("div",{className:"text-center py-20 text-slate-500 border-2 border-dashed border-slate-800 rounded-xl",children:[e.jsx(pe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"All caught up! No pending payments."})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:s.map(i=>{const g=i.status==="AUTO_CREDITED";return e.jsxs(y,{className:`bg-slate-900 border-slate-800 flex gap-4 ${g?"border-l-4 border-l-purple-500 bg-purple-900/10":""}`,children:[e.jsxs("div",{className:"w-24 h-24 bg-slate-950 rounded-lg relative group cursor-pointer border border-slate-800 shrink-0",onClick:()=>m(i.screenshotUrl),children:[e.jsx("img",{src:i.screenshotUrl,className:"w-full h-full object-cover rounded-lg opacity-80 group-hover:opacity-100 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 opacity-0 group-hover:opacity-100 rounded-lg transition-opacity",children:e.jsx(Vs,{className:"w-6 h-6 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded ${i.type==="CREDIT_PURCHASE"?"bg-blue-900 text-blue-300":i.type==="PARTNER_RECHARGE"?"bg-indigo-900 text-indigo-300":"bg-purple-900 text-purple-300"}`,children:i.type.replace("_"," ")}),g?e.jsxs("span",{className:"text-[10px] font-bold text-purple-400 bg-purple-900/50 px-2 py-0.5 rounded flex items-center gap-1 border border-purple-500/30",children:[e.jsx(q,{className:"w-3 h-3 fill-current"})," Auto-Added"]}):e.jsxs("span",{className:"text-[10px] text-slate-500 flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"})," Pending"]})]}),e.jsxs("h4",{className:"font-bold text-white text-lg",children:["₹",i.amount]}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1 flex items-center gap-1",children:[i.type==="PARTNER_RECHARGE"?e.jsx(Le,{className:"w-3 h-3"}):e.jsx(Ss,{className:"w-3 h-3"}),"From: ",e.jsx("span",{className:"text-white font-bold",children:i.partnerName||i.schoolName||i.studentName||"Unknown"})]}),e.jsxs("p",{className:"text-xs text-slate-500 font-mono mt-1 select-all",children:["Ref: ",i.transactionRef]})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:()=>j(i.id,g),disabled:d===i.id,className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-green-800 disabled:cursor-not-allowed text-white py-1.5 rounded-lg text-xs font-bold transition-colors",children:d===i.id?"Processing...":g?"Verify & Close":"Approve"}),e.jsx("button",{onClick:()=>C(i.id,g),disabled:d===i.id,className:"flex-1 bg-red-900/30 hover:bg-red-900/50 disabled:opacity-50 text-red-400 border border-red-900/50 py-1.5 rounded-lg text-xs font-bold transition-colors",children:g?"Reverse":"Reject"})]})]})]},i.id)})})]}),a&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 p-4",onClick:()=>m(null),children:[e.jsx("button",{className:"absolute top-4 right-4 text-white p-2",children:e.jsx(ge,{className:"w-8 h-8"})}),e.jsx("img",{src:a,className:"max-w-full max-h-[90vh] rounded-xl shadow-2xl"})]})]})},mt=()=>{const[s,n]=t.useState([]),[w,f]=t.useState(!1),[a,m]=t.useState(null),[d,N]=t.useState({mode:"PAY_PER_UNIT",costPerUnit:"0",flatRateMonthly:"5000",resultPublishCost:"1"}),[r,h]=t.useState({mode:"PAY_PER_UNIT",costPerUnit:"0",flatRateMonthly:"5000",resultPublishCost:"1"}),[l,p]=t.useState(!1);t.useEffect(()=>{i(),j()},[]);const j=async()=>{const b=await u.getGlobalSettings();if(b.DEFAULT_PARTNER_PLAN)try{const E=JSON.parse(b.DEFAULT_PARTNER_PLAN);h({mode:E.mode||"PAY_PER_UNIT",costPerUnit:(E.costPerUnit!==void 0?E.costPerUnit:0).toString(),flatRateMonthly:(E.flatRateMonthly||5e3).toString(),resultPublishCost:(E.resultPublishCost!==void 0?E.resultPublishCost:1).toString()})}catch{}},C=async()=>{p(!0);const b={mode:r.mode,costPerUnit:parseInt(r.costPerUnit),flatRateMonthly:parseInt(r.flatRateMonthly),resultPublishCost:parseFloat(r.resultPublishCost)};await u.updateGlobalSetting("DEFAULT_PARTNER_PLAN",JSON.stringify(b)),p(!1),alert("Default Plan Settings Saved!")},i=async()=>{f(!0);const b=await u.getAllPartners();n(b),f(!1)},g=b=>{var E,L,I,v,M,F;m(b),N({mode:((E=b.planConfig)==null?void 0:E.mode)||"PAY_PER_UNIT",costPerUnit:(((L=b.planConfig)==null?void 0:L.costPerUnit)!==void 0?(I=b.planConfig)==null?void 0:I.costPerUnit:0).toString(),flatRateMonthly:(((v=b.planConfig)==null?void 0:v.flatRateMonthly)||5e3).toString(),resultPublishCost:(((M=b.planConfig)==null?void 0:M.resultPublishCost)!==void 0?(F=b.planConfig)==null?void 0:F.resultPublishCost:1).toString()})},S=async()=>{if(!a)return;const b={mode:d.mode,costPerUnit:parseInt(d.costPerUnit),flatRateMonthly:parseInt(d.flatRateMonthly),resultPublishCost:parseFloat(d.resultPublishCost)},E=await u.updatePartnerPlan(a.id,b);E.success?(alert("Partner Plan Updated Successfully!"),i(),m(null)):alert("Failed to update: "+E.message)},_=({state:b,setState:E,isDefault:L=!1})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{onClick:()=>E({...b,mode:"PAY_PER_UNIT"}),className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${b.mode==="PAY_PER_UNIT"?"bg-blue-900/20 border-blue-500":"bg-slate-950 border-slate-800 hover:border-slate-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${b.mode==="PAY_PER_UNIT"?"border-blue-500":"border-slate-500"}`,children:b.mode==="PAY_PER_UNIT"&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})}),e.jsx("span",{className:"font-bold text-white text-xs",children:"Option A: Pay Per Unit"})]})}),e.jsx("div",{onClick:()=>E({...b,mode:"FLAT_SUBSCRIPTION"}),className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${b.mode==="FLAT_SUBSCRIPTION"?"bg-green-900/20 border-green-500":"bg-slate-950 border-slate-800 hover:border-slate-700"}`,children:e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${b.mode==="FLAT_SUBSCRIPTION"?"border-green-500":"border-slate-500"}`,children:b.mode==="FLAT_SUBSCRIPTION"&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})}),e.jsx("span",{className:"font-bold text-white text-xs",children:"Option B: Flat Sub"})]})})]}),b.mode==="PAY_PER_UNIT"?e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 animate-fade-in-up",children:[e.jsxs("label",{className:"text-xs font-bold text-blue-400 uppercase block mb-2 flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4"})," Cost Per School Creation (INR/Credits)"]}),e.jsx(B,{type:"number",value:b.costPerUnit,onChange:I=>E({...b,costPerUnit:I.target.value}),className:"bg-slate-900 border-slate-700 text-white font-mono font-bold",placeholder:"0 for Free"}),e.jsxs("p",{className:"text-[10px] text-slate-500 mt-2",children:["Set to ",e.jsx("b",{children:"0"})," for Free Creation (Freedom Model)."]})]}):e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800 animate-fade-in-up",children:[e.jsxs("label",{className:"text-xs font-bold text-green-400 uppercase block mb-2 flex items-center gap-2",children:[e.jsx(Rs,{className:"w-4 h-4"})," Monthly Flat Rate (INR)"]}),e.jsx(B,{type:"number",value:b.flatRateMonthly,onChange:I=>E({...b,flatRateMonthly:I.target.value}),className:"bg-slate-900 border-slate-700 text-white font-mono font-bold"})]}),e.jsxs("div",{className:"bg-slate-950 p-4 rounded-xl border border-slate-800",children:[e.jsxs("label",{className:"text-xs font-bold text-yellow-500 uppercase block mb-2 flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"})," Result Publishing Cost (Per Student)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{type:"number",value:b.resultPublishCost,onChange:I=>E({...b,resultPublishCost:I.target.value}),className:"bg-slate-900 border-slate-700 text-white font-mono font-bold",step:"0.1"}),e.jsx("span",{className:"text-xs text-slate-500 font-bold whitespace-nowrap",children:"Credits / Student"})]}),e.jsx("p",{className:"text-[10px] text-slate-500 mt-2",children:"This rate will be applied to all schools created by this partner."})]}),L&&e.jsx(U,{onClick:C,disabled:l,className:"w-full bg-slate-800 hover:bg-slate-700 text-white py-3 shadow-lg",children:l?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4 mr-2"})," Save Default Settings"]})})]});return e.jsxs("div",{className:"h-full flex flex-col animate-fade-in-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(Ge,{className:"w-6 h-6 text-indigo-500"})," Agency & Partner Manager"]}),e.jsx("p",{className:"text-slate-400 text-sm",children:"Configure Pricing Models for Resellers."})]}),e.jsx(U,{onClick:i,className:"bg-slate-800 text-white hover:bg-slate-700",children:e.jsx(X,{className:`w-4 h-4 ${w?"animate-spin":""}`})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"md:col-span-1 bg-slate-900 border border-slate-800 rounded-xl overflow-hidden flex flex-col",children:[e.jsx("div",{className:"p-4 border-b border-slate-800 bg-indigo-900/10",children:e.jsx("h3",{className:"font-bold text-indigo-400 text-sm",children:"Registered Partners"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:[w&&e.jsx("p",{className:"text-center text-slate-500 text-xs py-4",children:"Loading partners..."}),!w&&s.length===0&&e.jsx("p",{className:"text-center text-slate-500 text-xs py-4",children:"No partners found."}),s.map(b=>{var E,L,I;return e.jsxs("div",{onClick:()=>g(b),className:`p-3 rounded-lg border cursor-pointer transition-all ${(a==null?void 0:a.id)===b.id?"bg-slate-800 border-indigo-500":"bg-slate-900 border-slate-800 hover:border-slate-600"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h4",{className:"font-bold text-white text-sm",children:b.name}),e.jsx("span",{className:`text-[9px] font-bold px-1.5 py-0.5 rounded ${((E=b.planConfig)==null?void 0:E.mode)==="FLAT_SUBSCRIPTION"?"bg-green-900/30 text-green-400":"bg-blue-900/30 text-blue-400"}`,children:((L=b.planConfig)==null?void 0:L.mode)==="FLAT_SUBSCRIPTION"?"FLAT RATE":"PER UNIT"})]}),e.jsx("p",{className:"text-xs text-slate-500",children:b.email}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-1 flex justify-between",children:[e.jsxs("span",{children:["Code: ",b.code]}),e.jsxs("span",{children:["Rate: ",((I=b.planConfig)==null?void 0:I.resultPublishCost)||1," CR/s"]})]})]},b.id)})]})]}),e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[!a&&e.jsxs(y,{className:"bg-slate-900 border-slate-800 border-t-4 border-t-yellow-500",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5 text-yellow-500"})," Default Registration Settings"]}),e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["Choose the plan that will be assigned to ",e.jsx("b",{children:"NEW"})," partners automatically when they register."]}),e.jsx(_,{state:r,setState:h,isDefault:!0})]}),a&&e.jsxs(y,{className:"bg-slate-900 border-slate-800 border-t-4 border-t-indigo-500",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5 text-indigo-500"})," Configure: ",a.name]}),e.jsx("button",{onClick:()=>m(null),className:"text-slate-500 hover:text-white text-xs",children:"Close Editor"})]}),e.jsx(_,{state:d,setState:N}),e.jsxs(U,{onClick:S,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 shadow-lg mt-6",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"})," Update Partner Plan"]})]})]})]})]})},_t=()=>{const s=Es(),[n,w]=t.useState("overview"),[f,a]=t.useState(!1),m=()=>{const N=localStorage.getItem("sb_url"),r=localStorage.getItem("sb_key");localStorage.clear(),N&&localStorage.setItem("sb_url",N),r&&localStorage.setItem("sb_key",r),s("/login")},d=({id:N,label:r,icon:h})=>e.jsxs("button",{onClick:()=>{w(N),a(!1)},className:`p-3 rounded-xl flex items-center gap-3 text-sm font-bold transition-all w-full text-left ${n===N?"bg-blue-600/20 text-blue-400 border border-blue-600/50 shadow-[0_0_10px_rgba(37,99,235,0.2)]":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[e.jsx(h,{className:"w-5 h-5"})," ",r]});return e.jsxs("div",{className:"min-h-screen bg-slate-950 text-slate-100 font-sans pb-20 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-slate-900 border-b border-slate-800 p-4 flex justify-between items-center sticky top-0 z-50 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>a(!f),className:"md:hidden text-slate-400 hover:text-white",children:f?e.jsx(ge,{className:"w-6 h-6"}):e.jsx(Ts,{className:"w-6 h-6"})}),e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-[0_0_15px_rgba(37,99,235,0.5)]",children:e.jsx(Z,{className:"w-6 h-6 text-white animate-pulse"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"font-black text-lg md:text-xl text-white tracking-widest uppercase",children:["Result",e.jsx("span",{className:"text-blue-500",children:"Mate"})]}),e.jsx("p",{className:"text-[10px] md:text-xs font-mono text-slate-400",children:"SUPER ADMIN CONSOLE"})]})]}),e.jsxs("button",{onClick:m,className:"text-xs font-bold text-red-500 hover:text-red-400 flex items-center gap-2 border border-red-900/50 px-3 py-1.5 rounded-full hover:bg-red-900/20 transition-all",children:[e.jsx($s,{className:"w-3 h-3"})," ",e.jsx("span",{className:"hidden md:inline",children:"DISCONNECT"})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[e.jsxs("div",{className:`absolute inset-y-0 left-0 z-40 w-64 bg-slate-900/95 backdrop-blur border-r border-slate-800 p-4 flex flex-col gap-2 overflow-y-auto transform transition-transform duration-300 md:relative md:translate-x-0 ${f?"translate-x-0":"-translate-x-full"}`,children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 mt-2 pl-2",children:"Operations"}),e.jsx(d,{id:"overview",label:"Mission Control",icon:Is}),e.jsx(d,{id:"finance",label:"Finance & Approvals",icon:Me}),e.jsx(d,{id:"partners",label:"Partner Manager",icon:Ge}),e.jsx(d,{id:"inspector",label:"School Inspector",icon:Q}),e.jsx(d,{id:"security",label:"Fraud & Risk",icon:me}),e.jsx(d,{id:"growth",label:"Growth & Viral",icon:q}),e.jsx(d,{id:"schools",label:"School Manager",icon:ee}),e.jsx(d,{id:"content",label:"Syllabus & Content",icon:ve}),e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 mt-4 pl-2",children:"Technical"}),e.jsx(d,{id:"infra",label:"Infrastructure",icon:Os}),e.jsx(d,{id:"control",label:"System Control",icon:Be}),e.jsx(d,{id:"marketing",label:"Marketing",icon:Oe}),e.jsx(d,{id:"staff",label:"Staff & Roles",icon:ue}),e.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1 mt-4 pl-2",children:"Support"}),e.jsx(d,{id:"support",label:"Support Desk",icon:Us})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 md:hidden",onClick:()=>a(!1)}),e.jsxs("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto custom-scrollbar relative bg-slate-950 w-full",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5 pointer-events-none fixed"}),n==="overview"&&e.jsx(Ys,{}),n==="finance"&&e.jsx(xt,{}),n==="partners"&&e.jsx(mt,{}),n==="inspector"&&e.jsx(ot,{}),n==="security"&&e.jsx(dt,{}),n==="growth"&&e.jsx(at,{}),n==="schools"&&e.jsx(tt,{}),n==="content"&&e.jsx(lt,{}),n==="marketing"&&e.jsx(st,{}),n==="support"&&e.jsx(zs,{}),n==="control"&&e.jsx(Qs,{}),n==="infra"&&e.jsx(Zs,{}),n==="staff"&&e.jsx(et,{})]})]})]})};export{_t as default};
